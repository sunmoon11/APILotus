jQuery(document).ready(function(a){function t(){a(".crm_dropdown_list").length>0&&(f=a(".crm_dropdown_list").prop("id"))}function e(t,e){"main"==t?(a(".kk_campaign_alert").html(e),a(".kk_campaign_alert").fadeIn(1e3,function(){a(".kk_campaign_alert").fadeOut(3e3)})):"add"==t?(a(".category_add_alert").html(e),a(".category_add_alert").fadeIn(1e3,function(){a(".category_add_alert").fadeOut(3e3)})):"edit"==t&&(a(".category_edit_alert").html(e),a(".category_edit_alert").fadeIn(1e3,function(){a(".category_edit_alert").fadeOut(3e3)}))}function n(t){a(".kk_campaign_waiting").html(t?p:"")}function i(){a.ajax({type:"GET",url:"../daemon/ajax_admin/konnektive/campaign_category_list.php",data:{crm_id:f},success:function(t){var e='<li><a href="#" id="0">All Campaigns</a></li>';if("error"==t)return h=0,a(".category_dropdown_menu").html(e),void _();if("no_cookie"!=t){m=jQuery.parseJSON(t);for(var n=0;n<m.length;n++)e+='<li><a href="#" id="'+m[n][0]+'">'+m[n][1]+"</a></li>";a(".category_dropdown_menu").html(e),-1==h&&(h=m[m.length-1][0]),_()}else window.location.href="../../admin/login.php"},failure:function(a){e("main","Cannot load campaign category list.")}})}function o(){n(!0),h=0,u="",a.ajax({type:"GET",url:"../daemon/ajax_admin/konnektive/campaign_all_list.php",data:{crm_id:f},success:function(a){if(n(!1),"error"!=a)if("no_cookie"!=a){var t=jQuery.parseJSON(a);g=t[1],i()}else window.location.href="../../admin/login.php";else e("main","Cannot load campaign list.")},failure:function(a){n(!1),e("main","Cannot load campaign list.")}})}function d(t,o){n(!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/konnektive/campaign_category_add.php",data:{crm_id:f,category_name:a(".add_category_name").val(),campaign_ids:t,campaign_names:o},success:function(a){if(n(!1),"success"==a)h=-1,i();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");e("main","Category cannot be added.")}},failure:function(a){n(!1),e("main","Category cannot be added.")}})}function c(t,o){n(!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/konnektive/campaign_category_edit.php",data:{category_id:h,category_name:a(".edit_category_name").val(),campaign_ids:t,campaign_names:o},success:function(a){if(n(!1),"success"==a)i();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");e("main","Category cannot be changed.")}},failure:function(a){n(!1),e("main","Category cannot be changed.")}})}function r(){n(!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/konnektive/campaign_category_delete.php",data:{category_id:h},success:function(a){if(n(!1),"success"==a)h=0,i();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");e("main","Category cannot be deleted.")}},failure:function(a){n(!1),e("main","Category cannot be deleted.")}})}function _(){var t="";if(0==h){a(".category_toggle_button").html("All Campaigns"+y),a(".btn_category_add").prop("disabled",!1),a(".btn_category_edit").prop("disabled",!0),a(".btn_category_delete").prop("disabled",!0);for(n=0;n<g.length;n++)t+="<tr>",t+="<td>"+g[n][0]+"</td>",t+="<td>"+g[n][1]+"</td>",t+="<td>"+g[n][2]+"</td>",t+="<td>"+g[n][3]+"</td>",t+="<td>"+("0"==g[n][4]?"":"Yes")+"</td>",t+="</tr>";a(".table_campaign_body").html(t)}else{for(n=0;n<m.length;n++)if(h==m[n][0]){a(".category_toggle_button").html(m[n][1]+y);break}for(var e=l(h),n=0;n<e.length;n++)for(var i=0;i<g.length;i++)if(e[n]==g[i][0]){t+="<tr>",t+="<td>"+e[n]+"</td>",t+="<td>"+g[i][1]+"</td>",t+="<td>"+g[i][2]+"</td>",t+="<td>"+g[i][3]+"</td>",t+="<td>"+(0==g[i][4]?"":"Yes")+"</td>",t+="</tr>";break}a(".table_campaign_body").html(t),a(".btn_category_add").prop("disabled",!1),a(".btn_category_edit").prop("disabled",!1),a(".btn_category_delete").prop("disabled",!1)}}function l(a){for(var t=0;t<m.length;t++)if(a==m[t][0])return m[t][2].split(",");return""}var g,m,p='<img src="../images/loading.gif" style="width:22px;height:22px;">',s="",f=-1,u="",h=0,y=' <span class="caret"></span>';t(),o(),a("#category_add_modal").on("shown.bs.modal",function(){a(".add_category_name").focus()}),a("#category_edit_modal").on("shown.bs.modal",function(){a(".edit_category_name").focus()}),a(".crm_dropdown_menu").on("click","li",function(t){s=a(this).text(),f=a(this).find("a").attr("id"),a(".crm_toggle_button").html(s+y),o()}),a(".category_dropdown_menu").on("click","li",function(t){u=a(this).text(),h=a(this).find("a").attr("id"),a(".category_toggle_button").html(u+y),_()}),a(".btn_category_add").click(function(){a(".add_category_name").val("");for(var t="",e=0;e<g.length;e++)t+="<tr>",t+='<td><input id="'+g[e][0]+'" class="add_campaign_item" type="checkbox" style="margin:0;padding:0"></input></td>',t+="<td>"+g[e][0]+"</td>",t+='<td id="acname_'+g[e][0]+'">'+g[e][1]+"</td>",t+="</tr>";a(".table_add_category_body").html(t)}),a(".modal_btn_category_add").click(function(){if(""==a(".add_category_name").val())return e("add","Please input category Name."),void a(".add_category_name").focus();var t="",n="";a(".add_campaign_item").each(function(e){if(a(this).prop("checked")){""!=t&&(t+=","),""!=n&&(n+="::");var i=a(this).prop("id");t+=i,n+=a("#acname_"+i).html()}}),""!=t?(a("#category_add_modal").modal("toggle"),d(t,n)):e("add","Please select at least one campaign.")}),a("#all_add_campaign").click(function(){a(".add_campaign_item").each(function(t){a("#all_add_campaign").prop("checked")?a(this).prop("checked",!0):a(this).prop("checked",!1)})}),a(".btn_category_edit").click(function(){a(".edit_category_name").val(u);for(var t="",e=0;e<g.length;e++)t+="<tr>",t+='<td><input id="'+g[e][0]+'" class="edit_campaign_item" type="checkbox" style="margin:0;padding:0"></input></td>',t+="<td>"+g[e][0]+"</td>",t+='<td id="ecname_'+g[e][0]+'">'+g[e][1]+"</td>",t+="</tr>";a(".table_edit_category_body").html(t);var n=l(h);a(".edit_campaign_item").each(function(t){for(var e=a(this).prop("id"),i=0;i<n.length;i++)if(n[i]==e){a(this).prop("checked",!0);break}})}),a(".modal_btn_category_edit").click(function(){if(""==a(".edit_category_name").val())return e("edit","Please input category Name."),void a(".edit_category_name").focus();var t="",n="";a(".edit_campaign_item").each(function(e){if(a(this).prop("checked")){""!=t&&(t+=","),""!=n&&(n+="::");var i=a(this).prop("id");t+=i,n+=a("#ecname_"+i).html()}}),""!=t?(a("#category_edit_modal").modal("toggle"),c(t,n)):e("edit","Please select at least one campaign.")}),a("#all_edit_campaign").click(function(){a(".edit_campaign_item").each(function(t){a("#all_edit_campaign").prop("checked")?a(this).prop("checked",!0):a(this).prop("checked",!1)})}),a(".modal_btn_category_delete").click(function(){a("#category_delete_modal").modal("toggle"),r()})});