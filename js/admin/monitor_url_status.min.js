jQuery(document).ready(function(t){function s(s,e){"status"==s?(t(".site_status_alert").html(e),t(".site_status_alert").fadeIn(1e3,function(){t(".site_status_alert").fadeOut(3e3)})):"metrics"==s&&(t(".site_metrics_alert").html(e),t(".site_metrics_alert").fadeIn(1e3,function(){t(".site_metrics_alert").fadeOut(3e3)}))}function e(s,e){"status"==s?t(".site_status_waiting").html(e?l:""):"metrics"==s?t(".site_metrics_waiting").html(e?l:""):"issue"==s&&t(".site_issue_waiting").html(e?l:"")}function i(){e("status",!0),t.ajax({type:"GET",url:"../daemon/ajax_admin/monitor_lotus_status_list.php",data:{page_number:c,items_page:_},success:function(s){if(e("status",!1),"error"!=s)if("no_cookie"!=s){var i=jQuery.parseJSON(s),n="";p=i.total_count;for(var a=i.status.length,o=0;o<a;o++)n+="<tr>",n+="<td>"+((c-1)*_+o+1)+"</td>",n+="<td>"+i.status[o][1]+"</td>",n+="<td>"+i.status[o][2]+"</td>",i.status[o][3]>=200&&i.status[o][3]<300?n+='<td><span class="url_status_mark url_status_mark_success"></span></td>':n+='<td><span class="url_status_mark url_status_mark_fail"></span></td>',0==i.status[o][3]?n+="<td>Invalid URL</td>":n+="<td>"+i.status[o][3]+"</td>",n+="<td>"+i.status[o][4]+"</td>",n+="</tr>";t(".table_url_body").html(n),u()}else window.location.href="../../admin/login.php"},failure:function(t){e("status",!1),s("status","Cannot load Monitor URL status list.")}})}function n(){e("metrics",!0),t.ajax({type:"GET",url:"../daemon/ajax_admin/monitor_lotus_url_list.php",data:{page_number:0,items_page:0},success:function(i){if(e("metrics",!1),"error"!=i)if("no_cookie"!=i){for(var n=jQuery.parseJSON(i),a="",r=0;r<n.urls.length;r++)a+='<li><a href="#metrics" id="'+n.urls[r][0]+'">'+n.urls[r][1]+"</a></li>";n.urls.length>0&&(f=n.urls[0][0],t(".site_name_toggle_button").html(n.urls[0][1]+d),t(".site_name_dropdown_menu").html(a),o())}else window.location.href="../../admin/login.php";else s("metrics","Cannot load Monitor site name list.")},failure:function(t){e("metrics",!1),s("metrics","Cannot load Monitor site name list.")}})}function a(){e("issue",!0),t.ajax({type:"GET",url:"../daemon/ajax_admin/monitor_lotus_issues.php",data:{issue_count:20},success:function(s){if(e("issue",!1),"error"!=s)if("no_cookie"!=s){for(var i=jQuery.parseJSON(s),n="",a=0;a<i.length;a++){n+='<div class="issue_content">',n+='<div class="issue_title"><b>'+i[a][1]+"</b></div>",n+='<div class="issue_detail">',n+="<table>";for(var o=2;o<=6;o++)""!=i[a][o]&&(n+="<tr>",n+='<td class="issue_item">'+100*(o-1)+" : </td>",n+='<td style="padding-bottom: 5px; font-size:13px">'+i[a][o]+"</td>",n+="</tr>");n+="</table>",n+="</div>",n+="</div>"}t("#issue_history_content").html(n)}else window.location.href="../../admin/login.php"},failure:function(t){e("issue",!1)}})}function o(){e("metrics",!0),t.ajax({type:"GET",url:"../daemon/ajax_admin/monitor_lotus_site_history.php",data:{site_id:f,metrics_date:g},success:function(t){e("metrics",!1),"error"!=t?"no_cookie"!=t?r(jQuery.parseJSON(t),g):window.location.href="../../admin/login.php":s("main","Cannot load Monitor site metrics info.")},failure:function(t){e("metrics",!1),s("metrics","Cannot load Monitor site metrics info.")}})}function r(s,e){s[0];for(var i,n=s[1],a=s[2],o=[],r=[],u=a.length,l=0,d=0;d<u;d++){var c=a[d][0];c=moment(c).format("LLL"),o.push(c),l+=i=a[d][1],r.push(i)}if(0==u)i=0;else{var _=(i=l/u).toFixed(3);(i=i.toFixed(0))-_!=0&&(i=_)}var m="Uptime : "+i+"%";t(".uptime_sum").html(m);var p=t("#url_status_chart")[0].getContext("2d"),n="hour",f=3;"WEEK"===e?(n="day",f=1):"MONTH"===e&&(n="day",f=1);var b={type:"line",data:{labels:o,datasets:[{data:r,pointRadius:0,fill:!1,lineTension:0,borderWidth:1,borderColor:"#00b9ab",pointBackgroundColor:"#00b9ab",pointBorderColor:"#00b9ab",pointHintRadius:4}]},options:{legend:{display:!1},responsive:!0,maintainAspectRatio:!1,hover:{intersect:!1},tooltips:{mode:"index",intersect:!1,position:"average",backgroundColor:"rgba(128, 139, 150, 1)",callbacks:{title:function(t,s){return s.labels[t[0].index]+" (EST)"},label:function(t,s){return"Uptime: "+s.datasets[0].data[t.index]+"%"}},displayColors:!1},scales:{xAxes:[{type:"time",distribution:"series",time:{unit:n,stepSize:f},ticks:{source:"auto"},gridLines:{display:!1}}],yAxes:[{ticks:{beginAtZero:!0,stepSize:25,suggestedMin:0,suggestedMax:100}}]}}};h&&h.destroy(),h=new Chart(p,b)}function u(){var s="",e="";if(p>0){var i=Math.floor((c-1)/m),n=i*m+1,a=(i+1)*m;a*_>p&&(a=Math.floor(p/_),p%_>0&&a++);for(var o=n;o<=a;o++)s+=o==c?'<button type="button" class="btn btn-success btn-sm monitor_page" id="page_'+o+'">'+o+"</button>":'<button type="button" class="btn btn-default btn-sm monitor_page" id="page_'+o+'">'+o+"</button>";i>0&&(e+='<button type="button" class="btn btn-default btn-sm monitor_page" id="page_first">&lt;&lt;</button><button type="button" class="btn btn-default btn-sm monitor_page" id="page_prev">&lt;</button>'),e+=s,a*_<p&&(e+='<button type="button" class="btn btn-default btn-sm monitor_page" id="page_next">&gt;</button><button type="button" class="btn btn-default btn-sm monitor_page" id="page_last">&gt;&gt;</button>')}t(".monitor_pagination").html(e)}var l='<img src="../images/loading.gif" style="width:22px;height:22px;">',d=' <span class="caret"></span>',c=1,_=10,m=7,p=0,f=-1,b="",g="DAY",h=null;i(),a(),n(),setInterval(function(){i(),a()},3e5),t(".count_dropdown_menu li").on("click",function(s){_=t(this).text(),t(".count_toggle_button").html(_+' <span class="caret"></span>'),c=1,i()}),t(".site_name_dropdown_menu").on("click","li",function(s){b=t(this).text(),f=t(this).find("a").attr("id"),t(".site_name_toggle_button").html(b+d),o()}),t(".btn_metrics_date").click(function(){g=t(this).prop("id").substring(5),t(".btn_metrics_date").each(function(s){t(this).removeClass("active")}),t(this).addClass("active"),o()}),t(".monitor_pagination").on("click",".monitor_page",function(s){var e=t(this).prop("id").substring(5),n=Math.floor((c-1)/m);"first"==e?c=1:"prev"==e?c=(n-1)*m+1:"next"==e?c=(n+1)*m+1:"last"==e?(c=Math.floor(p/_),p%_>0&&c++):c=e,i()})});