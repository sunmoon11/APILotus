jQuery(document).ready(function(a){var d='<img src="../images/loading.gif" style="width:22px;height:22px;">',e=-1;function o(d,e){"main"==d?(a(".crm_account_alert").html(e),a(".crm_account_alert").fadeIn(1e3,function(){a(".crm_account_alert").fadeOut(3e3)})):"add"==d?(a(".crm_add_alert").html(e),a(".crm_add_alert").fadeIn(1e3,function(){a(".crm_add_alert").fadeOut(3e3)})):"edit"==d?(a(".crm_edit_alert").html(e),a(".crm_edit_alert").fadeIn(1e3,function(){a(".crm_edit_alert").fadeOut(3e3)})):"crm_password"==d?(a(".crm_password_alert").html(e),a(".crm_password_alert").fadeIn(1e3,function(){a(".crm_password_alert").fadeOut(3e3)})):"api_password"==d&&(a(".api_password_alert").html(e),a(".api_password_alert").fadeIn(1e3,function(){a(".api_password_alert").fadeOut(3e3)}))}function t(e){a(".crm_account_waiting").html(e?d:"")}function s(){t(!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/konnektive/crm_account_list.php",data:{},success:function(d){if(t(!1),a(".table_crm_body").html(""),"error"!=d)if("no_cookie"!=d){for(var e=jQuery.parseJSON(d),o="",s=0;s<e.length;s++)o+="<tr>",o+='<td id="name_'+e[s][0]+'">'+e[s][1]+"</td>",o+='<td id="url_'+e[s][0]+'">'+e[s][2]+"</td>",o+='<td id="id1_'+e[s][0]+'">'+e[s][3]+"</td>",o+='<td id="pass1_'+e[s][0]+'">'+e[s][4]+"</td>",o+='<td id="id2_'+e[s][0]+'">'+e[s][5]+"</td>",o+='<td id="pass2_'+e[s][0]+'">'+e[s][6]+"</td>",o+='<td id="goal_'+e[s][0]+'">'+e[s][7]+"</td>","1"==e[s][8]?o+='<td id="paused_'+e[s][0]+'"><span class="payment_badge payment_badge_red">Paused</span></td>':o+='<td id="paused_'+e[s][0]+'"></td>',o+="<td>",o+='<button type="button" class="btn btn-link btn-sm crm_account_edit" id="'+e[s][0]+'" data-toggle="modal" data-target="#crm_edit_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span>&nbsp;Edit</button>',o+='<button type="button" class="btn btn-link btn-sm crm_password_edit" id="'+e[s][0]+'" data-toggle="modal" data-target="#crm_password_modal"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span>&nbsp;CRM Password</button>',o+='<button type="button" class="btn btn-link btn-sm api_password_edit" id="'+e[s][0]+'" data-toggle="modal" data-target="#api_password_modal"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span>&nbsp;API Password</button>',o+='<button type="button" class="btn btn-link btn-sm crm_account_delete" id="'+e[s][0]+'" data-toggle="modal" data-target="#crm_delete_modal"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span>&nbsp;Delete</button>',o+="</td></tr>";a(".table_crm_body").html(o)}else window.location.href="../../admin/login.php";else a(".btn_crm_add").prop("disabled",!1)},failure:function(a){t(!1),o("main","Cannot load CRM account list.")}})}s(),a("#crm_add_modal").on("shown.bs.modal",function(){a(".add_crm_name").focus()}),a("#crm_edit_modal").on("shown.bs.modal",function(){a(".edit_crm_name").focus()}),a("#crm_password_modal").on("shown.bs.modal",function(){a(".edit_crm_password").focus()}),a("#api_password_modal").on("shown.bs.modal",function(){a(".edit_api_password").focus()}),a(".btn_crm_add").click(function(){a(".add_crm_name").val(""),a(".add_crm_url").val(""),a(".add_crm_username").val(""),a(".add_crm_password").val(""),a(".add_crm_repassword").val(""),a(".add_api_username").val(""),a(".add_api_password").val(""),a(".add_api_repassword").val(""),a(".add_sales_goal").val("0"),a(".add_crm_paused").prop("checked",!1)}),a(".modal_btn_crm_add").click(function(){return""==a(".add_crm_name").val()?(o("add","Please input CRM Name."),void a(".add_crm_name").focus()):""==a(".add_crm_url").val()?(o("add","Please input CRM Site URL."),void a(".add_crm_url").focus()):""==a(".add_crm_username").val()?(o("add","Please input CRM User Name."),void a(".add_crm_username").focus()):""==a(".add_crm_password").val()?(o("add","Please input CRM Password."),void a(".add_crm_password").focus()):a(".add_crm_password").val()!=a(".add_crm_repassword").val()?(o("add","Doesn't match CRM Password."),void a(".add_crm_repassword").focus()):""==a(".add_api_username").val()?(o("add","Please input API User Name."),void a(".add_api_username").focus()):""==a(".add_api_password").val()?(o("add","Please input API Password."),void a(".add_api_password").focus()):a(".add_api_password").val()!=a(".add_api_repassword").val()?(o("add","Doesn't match API Password."),void a(".add_api_repassword").focus()):""==a(".add_sales_goal").val()?(o("add","Please input Sales Goal."),void a(".add_sales_goal").focus()):(a("#crm_add_modal").modal("toggle"),void function(){t(!0);var d=0;a(".add_crm_paused").prop("checked")&&(d=1);a.ajax({type:"GET",url:"../daemon/ajax_admin/konnektive/crm_account_add.php",data:{crm_name:a(".add_crm_name").val(),crm_url:a(".add_crm_url").val(),crm_username:a(".add_crm_username").val(),crm_password:a(".add_crm_password").val(),api_username:a(".add_api_username").val(),api_password:a(".add_api_password").val(),sales_goal:a(".add_sales_goal").val(),crm_paused:d},success:function(a){if(t(!1),"success"==a)s();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");o("main","CRM account cannot be added.")}},failure:function(a){t(!1),o("main","CRM account cannot be added.")}})}())}),a(".table_crm_body").on("click",".crm_account_edit",function(d){e=a(this).prop("id"),a(".edit_crm_name").val(a("#name_"+e).text()),a(".edit_crm_url").val(a("#url_"+e).text()),a(".edit_crm_username").val(a("#id1_"+e).text()),a(".edit_api_username").val(a("#id2_"+e).text()),a(".edit_sales_goal").val(a("#goal_"+e).text()),"Paused"==a("#paused_"+e).text()?a(".edit_crm_paused").prop("checked",!0):a(".edit_crm_paused").prop("checked",!1)}),a(".modal_btn_crm_edit").click(function(){return""==a(".edit_crm_name").val()?(o("edit","Please input CRM Name."),void a(".edit_crm_name").focus()):""==a(".edit_crm_url").val()?(o("edit","Please input CRM Site URL."),void a(".edit_crm_url").focus()):""==a(".edit_crm_username").val()?(o("edit","Please input CRM User Name."),void a(".edit_crm_username").focus()):""==a(".edit_api_username").val()?(o("edit","Please input API User Name."),void a(".edit_api_username").focus()):""==a(".edit_sales_goal").val()?(o("edit","Please input Sales Goal."),void a(".edit_sales_goal").focus()):(a("#crm_edit_modal").modal("toggle"),void function(){t(!0);var d=0;a(".edit_crm_paused").prop("checked")&&(d=1);a.ajax({type:"GET",url:"../daemon/ajax_admin/konnektive/crm_account_edit.php",data:{crm_id:e,crm_name:a(".edit_crm_name").val(),crm_url:a(".edit_crm_url").val(),crm_username:a(".edit_crm_username").val(),api_username:a(".edit_api_username").val(),sales_goal:a(".edit_sales_goal").val(),crm_paused:d},success:function(a){if(t(!1),"success"==a)s();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");o("main","CRM account cannot be changed.")}},failure:function(a){t(!1),o("main","CRM account cannot be changed.")}})}())}),a(".table_crm_body").on("click",".crm_password_edit",function(d){e=a(this).prop("id"),a(".edit_crm_password").val(""),a(".edit_crm_repassword").val("")}),a(".modal_btn_crm_password").click(function(){return""==a(".edit_crm_password").val()?(o("crm_password","Please input CRM Password."),void a(".edit_crm_password").focus()):a(".edit_crm_password").val()!=a(".edit_crm_repassword").val()?(o("crm_password","Doesn't match CRM Password."),void a(".edit_crm_repassword").focus()):(a("#crm_password_modal").modal("toggle"),t(!0),void a.ajax({type:"GET",url:"../daemon/ajax_admin/konnektive/crm_account_crmpass.php",data:{crm_id:e,crm_password:a(".edit_crm_password").val()},success:function(a){if(t(!1),"success"==a)s();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");o("main","CRM Password cannot be changed.")}},failure:function(a){t(!1),o("main","CRM Password cannot be changed.")}}))}),a(".table_crm_body").on("click",".api_password_edit",function(d){e=a(this).prop("id"),a(".edit_api_password").val(""),a(".edit_api_repassword").val("")}),a(".modal_btn_api_password").click(function(){return""==a(".edit_api_password").val()?(o("api_password","Please input API Password."),void a(".edit_api_password").focus()):a(".edit_api_password").val()!=a(".edit_api_repassword").val()?(o("api_password","Doesn't match API Password."),void a(".edit_api_repassword").focus()):(a("#api_password_modal").modal("toggle"),t(!0),void a.ajax({type:"GET",url:"../daemon/ajax_admin/konnektive/crm_account_apipass.php",data:{crm_id:e,api_password:a(".edit_api_password").val()},success:function(a){if(t(!1),"success"==a)s();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");o("main","API Password cannot be changed.")}},failure:function(a){t(!1),o("main","API Password cannot be changed.")}}))}),a(".table_crm_body").on("click",".crm_account_delete",function(d){e=a(this).prop("id")}),a(".modal_btn_crm_delete").click(function(){a("#crm_delete_modal").modal("toggle"),t(!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/konnektive/crm_account_delete.php",data:{crm_id:e},success:function(a){if(t(!1),"success"==a)s();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");o("main","CRM account cannot be deleted.")}},failure:function(a){t(!1),o("main","CRM account cannot be deleted.")}})})});