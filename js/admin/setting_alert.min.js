jQuery(document).ready(function(e){function t(){e.ajax({type:"GET",url:"../daemon/ajax_admin/get_login_user.php",data:{},success:function(e){var t=jQuery.parseJSON(e);g=parseInt(t[2]),d()},failure:function(e){}})}function i(t,i){"level"==t?(e(".setting_crm_alert").html(i),e(".setting_crm_alert").fadeIn(1e3,function(){e(".setting_crm_alert").fadeOut(3e3)})):"level_edit"==t?(e(".alert_edit_level").html(i),e(".alert_edit_level").fadeIn(1e3,function(){e(".alert_edit_level").fadeOut(3e3)})):"receiver"==t?(e(".setting_receiver_alert").html(i),e(".setting_receiver_alert").fadeIn(1e3,function(){e(".setting_receiver_alert").fadeOut(3e3)})):"receiver_add"==t?(e(".receiver_add_alert").html(i),e(".receiver_add_alert").fadeIn(1e3,function(){e(".receiver_add_alert").fadeOut(3e3)})):"receiver_edit"==t&&(e(".receiver_edit_alert").html(i),e(".receiver_edit_alert").fadeIn(1e3,function(){e(".receiver_edit_alert").fadeOut(3e3)}))}function r(t,i){"level"==t?(y=i)?e(".alert_level_waiting").html(x):e(".alert_level_waiting").html(""):"receiver"==t&&((k=i)?e(".alert_receiver_waiting").html(x):e(".alert_receiver_waiting").html(""))}function a(){if(!y){r("level",!0);for(var t='<tr><th>#</th><th style="width:120px">CRM Name</th>',a=0;a<u.length;a++)"1"==u[a][10]&&(t+="<th>"+u[a][2]+"</th>");t+="<th>Action</th></tr>",e(".table_level_head").html(t),e.ajax({type:"GET",url:"../daemon/ajax_admin/crm_list.php",data:{},success:function(t){if(r("level",!1),"error"!=t)if("no_cookie"!=t){var a=(p=jQuery.parseJSON(t)).length,d="";if(a>0)for(c=0;c<a;c++){d+="<tr><td>"+(c+1)+"</td>",d+='<td id="name_'+p[c][0]+'">'+p[c][1]+"</td>";for(var n=0;n<u.length;n++)"1"==u[n][10]&&(d+='<td id="level_'+u[n][1]+"_"+p[c][0]+'"></td>');d+='<td><button type="button" class="btn btn-link btn-sm btn_level_edit" id="'+p[c][0]+'" data-toggle="modal" data-target="#level_edit_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span>&nbsp;Edit</button></td>',d+="</tr>"}else i("level","There is no any crm data.");e(".table_level_body").html(d);for(var c=0;c<u.length;c++)"1"==u[c][10]&&l(u[c][1])}else window.location.href="../../admin/login.php";else i("level","Cannot load CRM list.")},failure:function(e){r("level",!1),i("level","Cannot load CRM list.")}})}}function d(){e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_alert_type.php",data:{},success:function(t){if("error"!=t)if("no_cookie"!=t){u=jQuery.parseJSON(t);for(var r="",d=0;d<u.length;d++){r+="<tr>",r+="<td>"+u[d][1]+"</td>",r+="<td>"+u[d][2]+"</td>",r+="<td>"+u[d][3]+"</td>",r+="<td>"+u[d][4]+"</td>";var l="";""!=u[d][5]&&(l=u[d][5]),""!=u[d][6]&&(""!=l&&(l+=" "),l+="("+u[d][6]+" hour)"),"1"==u[d][7]&&(""!=l&&(l+=", "),l+="SMS"),"1"==u[d][8]&&(""!=l&&(l+=", "),l+="Email"),"1"==u[d][9]&&(""!=l&&(l+=", "),l+="Telegram Bot"),r+="<td>"+l+"</td>",r+='<td><button type="button" class="btn btn-link btn-sm btn_type_edit" id="'+u[d][1]+'" data-toggle="modal" data-target="#type_edit_modal"><span class="glyphicon glyphicon-time" aria-hidden="true"></span>&nbsp;Schedule</button></td>',r+="</tr>"}e(".table_type_body").html(r),a()}else window.location.href="../../admin/login.php";else i("level","Cannot load Alert Type list.")},failure:function(e){r("level",!1),i("level","Cannot load Alert Type list.")}})}function l(t){e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_alert_list.php",data:{alert_type:t},success:function(t){var r=jQuery.parseJSON(t);if("error"!=r[0])if("no_cookie"!=r[0])for(var a=0;a<r[2].length;a++)e("#level_"+r[2][a][2]+"_"+r[2][a][1]).html(r[2][a][4]);else window.location.href="../../admin/login.php";else i("level","Cannot load alert level information.")},failure:function(e){i("level","Cannot load alert level information.")}})}function n(t,r,d,l,n){e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_alert_edit.php",data:{type:t,crm_id:r,level1:d,level2:l},success:function(e){if("error"==e)i("level","Alert level cannot be changed.");else if("no_cookie"==e)return void(window.location.href="../../admin/login.php");n&&a()},failure:function(e){i("level","Alert level cannot be changed.")}})}function c(t,r,a,l,n,c){e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_schedule_edit.php",data:{type:t,days:r,hours:a,sms:l,email:n,bot:c},success:function(e){if("error"==e)i("level","Alert Schedule cannot be changed.");else{if("no_cookie"==e)return void(window.location.href="../../admin/login.php");d()}},failure:function(e){i("level","Alert Schedule cannot be changed.")}})}function o(){r("receiver",!0),e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_receiver_list.php",data:{},success:function(t){var a=jQuery.parseJSON(t);if(r("receiver",!1),"error"!=a[0])if("no_cookie"!=a[0]){for(var d=a[1],l="",n="",c="",o=0,_=0,s=0,v=0;v<d.length;v++)"0"==d[v][1]?(l+="<tr>",l+="<td>"+ ++o+"</td>",l+='<td id="name1_'+d[v][0]+'" style="word-wrap:break-word;word-break:break-all;">'+d[v][2]+"</td>",l+='<td id="stts1_'+d[v][0]+'">'+("1"==d[v][3]?"Enable":"Disable")+"</td>",9==g&&(l+="<td>",l+='<button type="button" class="btn btn-link btn-sm btn_receiver_sms_edit" id="'+d[v][0]+'" data-toggle="modal" data-target="#receiver_edit_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></button>',l+='<button type="button" class="btn btn-link btn-sm btn_receiver_sms_delete" id="'+d[v][0]+'" data-toggle="modal" data-target="#receiver_delete_modal"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span></button>',l+="</td>"),l+="</tr>"):"1"==d[v][1]?(n+="<tr>",n+="<td>"+ ++_+"</td>",n+='<td id="name2_'+d[v][0]+'" style="word-wrap:break-word;word-break:break-all;">'+d[v][2]+"</td>",n+='<td id="stts2_'+d[v][0]+'">'+("1"==d[v][3]?"Enable":"Disable")+"</td>",9==g&&(n+="<td>",n+='<button type="button" class="btn btn-link btn-sm btn_receiver_mail_edit" id="'+d[v][0]+'" data-toggle="modal" data-target="#receiver_edit_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></button>',n+='<button type="button" class="btn btn-link btn-sm btn_receiver_mail_delete" id="'+d[v][0]+'" data-toggle="modal" data-target="#receiver_delete_modal"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span></button>',n+="</td>"),n+="</tr>"):"2"==d[v][1]&&(c+="<tr>",c+="<td>"+ ++s+"</td>",c+='<td id="name3_'+d[v][0]+'" style="word-wrap:break-word;word-break:break-all;">'+d[v][2]+"</td>",c+='<td id="chatid3_'+d[v][0]+'">'+d[v][4]+"</td>",c+='<td id="stts3_'+d[v][0]+'">'+("1"==d[v][3]?"Enable":"Disable")+"</td>",9==g&&(c+="<td>",c+='<button type="button" class="btn btn-link btn-sm btn_receiver_bot_edit" id="'+d[v][0]+'" data-toggle="modal" data-target="#receiver_edit_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></button>',c+='<button type="button" class="btn btn-link btn-sm btn_receiver_bot_delete" id="'+d[v][0]+'" data-toggle="modal" data-target="#receiver_delete_modal"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span></button>',c+="</td>"),c+="</tr>");e(".table_receiver_sms_body").html(l),e(".table_receiver_mail_body").html(n),e(".table_receiver_bot_body").html(c)}else window.location.href="../../admin/login.php";else i("receiver","Cannot load alert receiver list.")},failure:function(e){r("account",!1),i("account","Cannot load account list.")}})}function _(t){r("receiver",!0);var a=1;e(".add_receiver_state").prop("checked")&&(a=0),e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_receiver_add.php",data:{type:t,address:e(".add_receiver_name").val(),chat_id:e(".add_receiver_chatid").val(),status:a},success:function(e){if(r("receiver",!1),"success"==e)o();else{if("no_cookie"==e)return void(window.location.href="../../admin/login.php");i("receiver","Alert receiver cannot be added.")}},failure:function(e){r("receiver",!1),i("receiver","Alert receiver cannot be added.")}})}function s(t){r("receiver",!0);var a=1;e(".edit_receiver_state").prop("checked")&&(a=0),e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_receiver_edit.php",data:{receiver_id:b,type:t,address:e(".edit_receiver_name").val(),chat_id:e(".edit_receiver_chatid").val(),status:a},success:function(e){if(r("receiver",!1),"success"==e)o();else{if("no_cookie"==e)return void(window.location.href="../../admin/login.php");i("receiver","Alert receiver cannot be changed.")}},failure:function(e){r("receiver",!1),i("receiver","Alert receiver cannot be changed.")}})}function v(t){r("receiver",!0),e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_receiver_delete.php",data:{receiver_id:b},success:function(e){if(r("receiver",!1),"success"==e)o();else{if("no_cookie"==e)return void(window.location.href="../../admin/login.php");i("receiver","Alert receiver cannot be deleted.")}},failure:function(e){r("receiver",!1),i("receiver","Alert receiver cannot be deleted.")}})}var p,u,m=-1,h=-1,b=-1,f="",g=0,y=!1,k=!1,x='<img src="../images/loading.gif" style="width:22px;height:22px;">';t(),e(".table_level_body").on("click",".btn_level_edit",function(t){m=e(this).prop("id");var i="";i+='<div class="alert alert-warning alert_edit_level" role="alert" style="display:none"></div>',i+='<div class="row" style="margin-bottom:5px;">',i+='<div class="col-xs-6 modal_input_label">CRM Name</div>',i+='<div class="col-xs-6"><input type="text" class="form-control input-sm edit_crm_name" readonly value="'+e("#name_"+m).text()+'"></div>',i+="</div>";for(var r=0;r<u.length;r++)"1"==u[r][10]&&(i+='<div class="row" style="margin-bottom:5px;">',i+='<div class="col-xs-6 modal_input_label">'+u[r][2]+"</div>",i+='<div class="col-xs-6"><input type="text" class="form-control input-sm edit_level_'+u[r][1]+'" value="'+e("#level_"+u[r][1]+"_"+m).text()+'"></div>',i+="</div>");e(".modal_level_body").html(i)}),e(".modal_btn_level_edit").click(function(){for(r=0;r<u.length;r++)if("1"==u[r][10]&&""==e(".edit_level_"+u[r][1]).val())return i("level_edit","Please input Alert level."),void e(".edit_level_"+u[r][1]).focus();e("#level_edit_modal").modal("toggle");for(var t=0,r=0;r<u.length;r++)"1"==u[r][10]&&t++;for(r=0;r<u.length;r++)"1"==u[r][10]&&n(u[r][1],m,e(".edit_level_"+u[r][1]).val(),"0",r==t-1)}),e(".table_type_body").on("click",".btn_type_edit",function(t){h=e(this).prop("id"),e(".edit_day").each(function(t){e(this).prop("checked",!1)}),e(".edit_hour").each(function(t){e(this).prop("checked",!1)}),e(".edit_receiver").each(function(t){e(this).prop("checked",!1)});for(var i=0;i<u.length;i++)if(h==u[i][1]){for(var r=u[i][5].split(","),a=u[i][6].split(","),d=u[i][7],l=u[i][8],n=u[i][9],c=0;c<r.length;c++)e("#day_"+r[c]).prop("checked",!0);for(var o=0;o<a.length;o++)e("#hour_"+a[o]).prop("checked",!0);return"1"==d&&e("#receiver_0").prop("checked",!0),"1"==l&&e("#receiver_1").prop("checked",!0),void("1"==n&&e("#receiver_2").prop("checked",!0))}}),e(".modal_btn_type_edit").click(function(){var t="";e(".edit_day").each(function(i){e(this).prop("checked")&&(""!=t&&(t+=","),t+=e(this).prop("id").substring(4))});var i="";e(".edit_hour").each(function(t){e(this).prop("checked")&&(""!=i&&(i+=","),i+=e(this).prop("id").substring(5))});var r=e("#receiver_0").prop("checked")?"1":"0",a=e("#receiver_1").prop("checked")?"1":"0",d=e("#receiver_2").prop("checked")?"1":"0";e("#type_edit_modal").modal("toggle"),c(h,t,i,r,a,d)}),e(".btn_receiver_sms_add").click(function(){f="sms",e(".add_receiver_label").html("SMS Number"),e(".add_receiver_name").val(""),e(".add_receiver_chatid").val(""),e(".add_receiver_state").prop("checked",!1),e("#telegram_add_chatid").css("display","none")}),e(".modal_btn_receiver_add").click(function(){if("sms"==f){if(""==e(".add_receiver_name").val())return i("receiver_add","Please input SMS Number."),void e(".add_receiver_name").focus();_(0)}else if("mail"==f){if(""==e(".add_receiver_name").val())return i("receiver_add","Please input Email Address."),void e(".add_receiver_name").focus();_(1)}else if("bot"==f){if(""==e(".add_receiver_name").val())return i("receiver_add","Please input User Name."),void e(".add_receiver_name").focus();if(""==e(".add_receiver_chatid").val())return i("receiver_add","Please input Chat ID."),void e(".add_receiver_chatid").focus();_(2)}e("#receiver_add_modal").modal("toggle")}),e(".table_receiver_sms_body").on("click",".btn_receiver_sms_edit",function(t){f="sms",b=e(this).prop("id"),e(".edit_receiver_label").html("SMS Number"),e(".edit_receiver_name").val(e("#name1_"+b).text()),"Disable"==e("#stts1_"+b).text()?e(".edit_receiver_state").prop("checked",!0):e(".edit_receiver_state").prop("checked",!1),e(".edit_receiver_chatid").val(""),e("#telegram_edit_chatid").css("display","none")}),e(".modal_btn_receiver_edit").click(function(){if("sms"==f){if(""==e(".edit_receiver_name").val())return i("receiver_edit","Please input SMS Number."),void e(".edit_receiver_name").focus();s(0)}else if("mail"==f){if(""==e(".edit_receiver_name").val())return i("receiver_edit","Please input Email Address."),void e(".edit_receiver_name").focus();s(1)}else if("bot"==f){if(""==e(".edit_receiver_name").val())return i("receiver_edit","Please input User Name."),void e(".edit_receiver_name").focus();if(""==e(".edit_receiver_chatid").val())return i("receiver_edit","Please input Chat ID."),void e(".edit_receiver_chatid").focus();s(2)}e("#receiver_edit_modal").modal("toggle")}),e(".table_receiver_sms_body").on("click",".btn_receiver_sms_delete",function(t){f="sms",b=e(this).prop("id")}),e(".modal_btn_receiver_delete").click(function(){e("#receiver_delete_modal").modal("toggle"),"sms"==f?v(0):"mail"==f?v(1):"bot"==f&&v(2)}),e(".btn_receiver_mail_add").click(function(){f="mail",e(".add_receiver_label").html("Email Address"),e(".add_receiver_name").val(""),e(".add_receiver_state").prop("checked",!1),e(".add_receiver_chatid").val(""),e("#telegram_add_chatid").css("display","none")}),e(".table_receiver_mail_body").on("click",".btn_receiver_mail_edit",function(t){f="mail",b=e(this).prop("id"),e(".edit_receiver_label").html("Email Address"),e(".edit_receiver_name").val(e("#name2_"+b).text()),"Disable"==e("#stts2_"+b).text()?e(".edit_receiver_state").prop("checked",!0):e(".edit_receiver_state").prop("checked",!1),e(".edit_receiver_chatid").val(""),e("#telegram_edit_chatid").css("display","none")}),e(".table_receiver_mail_body").on("click",".btn_receiver_mail_delete",function(t){f="mail",b=e(this).prop("id")}),e(".btn_receiver_bot_add").click(function(){f="bot",e(".add_receiver_label").html("User Name"),e(".add_receiver_name").val(""),e(".add_receiver_state").prop("checked",!1),e(".add_receiver_chatid").val(""),e("#telegram_add_chatid").css("display","inherit")}),e(".table_receiver_bot_body").on("click",".btn_receiver_bot_edit",function(t){f="bot",b=e(this).prop("id"),e(".edit_receiver_label").html("User Name"),e(".edit_receiver_name").val(e("#name3_"+b).text()),"Disable"==e("#stts3_"+b).text()?e(".edit_receiver_state").prop("checked",!0):e(".edit_receiver_state").prop("checked",!1),e(".edit_receiver_chatid").val(e("#chatid3_"+b).text()),e("#telegram_edit_chatid").css("display","inherit")}),e(".table_receiver_bot_body").on("click",".btn_receiver_bot_delete",function(t){f="bot",b=e(this).prop("id")})});