jQuery(document).ready(function(t){function n(){b=!0,h=!1,a(),e(),i()}function a(){t(".setting_card_waiting").html(c),t.ajax({type:"GET",url:"../daemon/ajax_admin/payment_card_get.php",data:{},success:function(n){t(".setting_card_waiting").html("");var a,e=jQuery.parseJSON(n);if(l="","success"==e[0])l=e[1].id,u=e[1].exp_month,p=e[1].exp_year,a="<tr><th>Card Brand</th><th>"+e[1].brand+"</th></tr>",t("#table_card_head").html(a),a="<tr><td>Country</td><td>"+e[1].country+"</td></tr>",a+="<tr><td>Card Number</td><td>**** **** **** "+e[1].last4+"</td></tr>",a+="<tr><td>Expiry Date</td><td>"+e[1].exp_month+" / "+e[1].exp_year+"</td></tr>","pass"==e[1].cvc_check?(a+='<tr><td>CVC Check</td><td><span class="payment_badge payment_badge_blue">passed</span></td></tr>',h=!0):a+='<tr><td>CVC Check</td><td><span class="payment_badge payment_badge_red">'+e[1].cvc_check+"</span></td></tr>",a+="<tr><td>Card ID</td><td>"+e[1].id+"</td></tr>",t("#table_card_body").html(a),a='<button id="btn_new_card" type="button" class="btn btn-default btn-sm" disabled style="margin-right:10px"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>&nbsp;New Card</button>',a+='<button id="btn_edit_card" type="button" class="btn btn-default btn-sm" style="margin-right:10px"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span>&nbsp;Edit</button>',a+='<button id="btn_delete_card" type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span>&nbsp;Delete</button>',t("#card_buttons").html(a);else{if("no_cookie"==e[0])return void(window.location.href="../../admin/login.php");t("#table_card_head").html(""),t("#table_card_body").html(""),a='<button id="btn_new_card" type="button" class="btn btn-default btn-sm" style="margin-right:10px"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>&nbsp;New Card</button>',a+='<button id="btn_edit_card" type="button" class="btn btn-default btn-sm" disabled style="margin-right:10px"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span>&nbsp;Edit</button>',a+='<button id="btn_delete_card" type="button" class="btn btn-default btn-sm" disabled><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span>&nbsp;Delete</button>',t("#card_buttons").html(a)}},failure:function(n){t(".setting_card_waiting").html("")}})}function e(){t(".setting_subscription_waiting").html(c),t.ajax({type:"GET",url:"../daemon/ajax_admin/payment_subscription_get.php",data:{},success:function(n){t(".setting_subscription_waiting").html("");var a=jQuery.parseJSON(n),e="";if("success"==a[0])e="<tr><th>Plan Name</th><th>"+a[1].plan.id+"</th></tr>",t("#table_subscription_head").html(e),e="<tr><td>Price</td><td>$"+a[1].plan.amount/100+"</td></tr>",e+="<tr><td>Interval</td><td>"+a[1].plan.interval+"</td></tr>",e+="<tr><td>Subscription Created Date</td><td>"+d(a[1].created)+"</td></tr>",e+="<tr><td>Current Period Start</td><td>"+d(a[1].current_period_start)+"</td></tr>",e+="<tr><td>Current Period End</td><td>"+d(a[1].current_period_end)+"</td></tr>","active"==a[1].status?e+='<tr><td>Subscription Status</td><td><span class="payment_badge payment_badge_blue">'+a[1].status+"</span></td></tr>":e+='<tr><td>Subscription Status</td><td><span class="payment_badge payment_badge_red">'+a[1].status+"</span></td></tr>",e+="<tr><td>Subscription ID</td><td>"+a[1].id+"</td></tr>",t("#table_subscription_body").html(e),e='<button id="btn_new_subscription" type="button" class="btn btn-default btn-sm" disabled style="margin-right:10px"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>&nbsp;New Subscription</button>',e+='<button id="btn_cancel_subscription" type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span>&nbsp;Cancel</button>',t("#subscription_buttons").html(e);else{if("no_cookie"==a[0])return void(window.location.href="../../admin/login.php");t("#table_subscription_head").html(""),t("#table_subscription_body").html(""),e='<button id="btn_new_subscription" type="button" class="btn btn-default btn-sm" style="margin-right:10px"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>&nbsp;New Subscription</button>',e+='<button id="btn_cancel_subscription" type="button" class="btn btn-default btn-sm" disabled><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span>&nbsp;Cancel</button>',t("#subscription_buttons").html(e)}},failure:function(n){t(".setting_subscription_waiting").html("")}})}function i(){t(".setting_payment_waiting").html(c),t.ajax({type:"GET",url:"../daemon/ajax_admin/payment_invoices_get.php",data:{},success:function(n){t(".setting_payment_waiting").html("");var a=jQuery.parseJSON(n),e="";if("success"==a[0]){for(var i=a[1].data.length,r=0;r<i;r++)e+="<tr>",e+="<td>"+(r+1)+"</td>",e+="<td>$"+a[1].data[r].amount_due/100+"</td>",1==a[1].data[r].paid?e+='<td><span class="payment_badge payment_badge_cyan">Paid</span></td>':e+="<td></td>",e+="<td>"+d(a[1].data[r].date)+"</td>",e+="<td>"+d(a[1].data[r].period_start)+" - "+d(a[1].data[r].period_end)+"</td>",e+="<td>"+a[1].data[r].id+"</td>",e+="</tr>";t("#table_payment_body").html(e)}else{if("no_cookie"==a[0])return void(window.location.href="../../admin/login.php");t("#table_payment_body").html("")}},failure:function(n){t(".setting_payment_waiting").html("")}})}function d(t){var n=new Date(1e3*t);return n.getFullYear()+"/"+((n.getMonth()<9?"0":"")+(n.getMonth()+1))+"/"+((n.getDate()<10?"0":"")+n.getDate())+" "+((n.getHours()<10?"0":"")+n.getHours())+":"+((n.getMinutes()<10?"0":"")+n.getMinutes())+":"+((n.getSeconds()<10?"0":"")+n.getSeconds())}var r,o,s,c='<img src="../images/loading.gif" style="width:22px;height:22px;">',l="",u="",p="",_=Stripe("pk_test_kyxgtxD5BcPyVARUJbiRgQCN"),m=_.elements(),b=!0,h=!1;!function(){n();var t={base:{color:"#303238",fontSize:"15px",lineHeight:"34px",fontSmoothing:"antialiased","::placeholder":{color:"#d9d9d9"}},invalid:{color:"#e5424d",":focus":{color:"#303238"}}};r=m.create("cardNumber",{style:t}),o=m.create("cardExpiry",{style:t}),s=m.create("cardCvc",{style:t}),r.mount("#card_number"),o.mount("#card_expiry"),s.mount("#card_cvc")}(),r.addEventListener("change",function(n){b=!1,1!=n.empty?n.error?t("#warning_card_number").html(n.error.message):t("#warning_card_number").html(""):t("#warning_card_number").html("You can't leave this empty.")}),o.addEventListener("change",function(n){b=!1,1!=n.empty?n.error?t("#warning_expiry_date").html(n.error.message):t("#warning_expiry_date").html(""):t("#warning_expiry_date").html("You can't leave this empty.")}),s.addEventListener("change",function(n){b=!1,1!=n.empty?n.error?t("#warning_cvc_number").html(n.error.message):t("#warning_cvc_number").html(""):t("#warning_cvc_number").html("You can't leave this empty.")}),t("#card_buttons").on("click","#btn_new_card",function(n){t("#new_card_modal").modal("show")}),t("#modal_btn_new_card").click(function(){if(b)return t("#warning_card_number").html("You can't leave this empty."),t("#warning_expiry_date").html("You can't leave this empty."),void t("#warning_cvc_number").html("You can't leave this empty.");""==t("#warning_card_number").html()&&""==t("#warning_expiry_date").html()&&""==t("#warning_cvc_number").html()&&(t("#new_card_modal").modal("hide"),t("#waiting_modal").modal("show"),_.createToken(r).then(function(a){a.token?t.ajax({type:"GET",url:"../daemon/ajax_admin/payment_card_new.php",data:{token_id:a.token.id,card_id:a.token.card.id},success:function(a){if(t("#waiting_modal").modal("hide"),"success"==a)n();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");alert("New Card Error!")}},failure:function(n){t("#waiting_modal").modal("hide"),alert("New Card Error!")}}):t("#waiting_modal").modal("hide")}))}),t("#card_buttons").on("click","#btn_edit_card",function(n){t("#expiry_month").val(u),t("#expiry_year").val(p),t("#edit_card_modal").modal("show")}),t("#modal_btn_edit_card").click(function(){t("#edit_card_modal").modal("hide"),t.ajax({type:"GET",url:"../daemon/ajax_admin/payment_card_update.php",data:{expiry_month:t("#expiry_month").val(),expiry_year:t("#expiry_year").val()},success:function(t){if("success"==t)n();else{if("no_cookie"==t)return void(window.location.href="../../admin/login.php");alert("Edit card error!")}},failure:function(t){}})}),t("#card_buttons").on("click","#btn_delete_card",function(n){t("#delete_card_modal").modal("show")}),t("#modal_btn_delete_card").click(function(){t("#delete_card_modal").modal("hide"),t.ajax({type:"GET",url:"../daemon/ajax_admin/payment_card_delete.php",data:{},success:function(t){if("success"==t)n();else{if("no_cookie"==t)return void(window.location.href="../../admin/login.php");alert("Delete card error!")}},failure:function(t){}})}),t("#subscription_buttons").on("click","#btn_new_subscription",function(n){h?(t(".setting_subscription_waiting").html(c),t.ajax({type:"GET",url:"../daemon/ajax_admin/payment_plan_get.php",data:{},success:function(n){t(".setting_subscription_waiting").html("");var a=jQuery.parseJSON(n);if("success"==a[0])t("#plan_name").val(a[1].id),t("#plan_price").val("$"+a[1].amount/100),t("#plan_interval").val(a[1].interval),t("#new_subscription_modal").modal("show");else{if("no_cookie"==a[0])return void(window.location.href="../../admin/login.php");alet("Cannot get plan for subscription.")}},failure:function(n){t(".setting_subscription_waiting").html("")}})):alert("Please add card first and try it again.")}),t("#modal_btn_new_subscription").click(function(){t("#new_subscription_modal").modal("hide"),t("#waiting_modal").modal("show"),t.ajax({type:"GET",url:"../daemon/ajax_admin/payment_subscription_new.php",data:{},success:function(a){if(t("#waiting_modal").modal("hide"),"success"==a)n();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");alert("New subscription error!")}},failure:function(n){t("#waiting_modal").modal("hide")}})}),t("#subscription_buttons").on("click","#btn_cancel_subscription",function(n){t("#cancel_subscription_modal").modal("show")}),t("#modal_btn_cancel_subscription").click(function(){t("#cancel_subscription_modal").modal("hide"),t.ajax({type:"GET",url:"../daemon/ajax_admin/payment_subscription_cancel.php",data:{},success:function(t){if("success"==t)n();else{if("no_cookie"==t)return void(window.location.href="../../admin/login.php");alert("Cancel subscription error!")}},failure:function(t){}})})});