jQuery(document).ready(function(a){var t,e=-1,n=-1,o=0,d=!1,i='<img src="../images/loading.gif" style="width:22px;height:22px;">',c="";function s(t,e){"account"==t?(a(".setting_account_alert").html(e),a(".setting_account_alert").fadeIn(1e3,function(){a(".setting_account_alert").fadeOut(3e3)})):"account_add"==t?(a(".account_add_alert").html(e),a(".account_add_alert").fadeIn(1e3,function(){a(".account_add_alert").fadeOut(3e3)})):"account_edit"==t?(a(".account_edit_alert").html(e),a(".account_edit_alert").fadeIn(1e3,function(){a(".account_edit_alert").fadeOut(3e3)})):"account_password"==t?(a(".account_password_alert").html(e),a(".account_password_alert").fadeIn(1e3,function(){a(".account_password_alert").fadeOut(3e3)})):"blockip"==t?(a(".setting_ip_alert").html(e),a(".setting_ip_alert").fadeIn(1e3,function(){a(".setting_ip_alert").fadeOut(3e3)})):"blockip_modal"==t&&(a(".block_ip_alert").html(e),a(".block_ip_alert").fadeIn(1e3,function(){a(".block_ip_alert").fadeOut(3e3)}))}function l(t,e){"account"==t?(d=e)?a(".setting_account_waiting").html(i):a(".setting_account_waiting").html(""):"blockip"==t&&(e?a(".setting_ip_waiting").html(i):a(".setting_ip_waiting").html(""))}function _(){d||(l("account",!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_account_list.php",data:{},success:function(e){if(l("account",!1),"error"!=e)if("no_cookie"!=e){var n=(t=jQuery.parseJSON(e)).length,d="";if(n>0)for(var i=0;i<n;i++)d+="<tr><td>"+(i+1)+"</td>",d+='<td id="name_'+t[i][0]+'">'+t[i][1]+"</td>",d+='<td id="disp_'+t[i][0]+'">'+t[i][3]+"</td>","1"==t[i][10]||""==t[i][7]?d+='<td id="sms_'+t[i][0]+'">'+t[i][7]+"</td>":d+='<td id="sms_'+t[i][0]+'"><span class="payment_badge payment_badge_red">'+t[i][7]+"</span></td>","1"==t[i][11]||""==t[i][8]?d+='<td id="email_'+t[i][0]+'">'+t[i][8]+"</td>":d+='<td id="email_'+t[i][0]+'"><span class="payment_badge payment_badge_red" style="text-transform: none">'+t[i][8]+"</span></td>","1"==t[i][12]||""==t[i][9]?d+='<td id="bot_'+t[i][0]+'">'+t[i][9]+"</td>":d+='<td id="bot_'+t[i][0]+'"><span class="payment_badge payment_badge_red">'+t[i][9]+"</span></td>","9"==t[i][4]?d+='<td id="role_'+t[i][0]+'">Administrator</td>':"1"==t[i][4]?d+='<td id="role_'+t[i][0]+'">Super User</td>':"0"==t[i][4]?d+='<td id="role_'+t[i][0]+'">Regular User</td>':d+='<td id="role_'+t[i][0]+'">Unknown</td>',"1"==t[i][5]?d+='<td id="state_'+t[i][0]+'"><span class="payment_badge payment_badge_blue">Enable</span></td><td>':d+='<td id="state_'+t[i][0]+'"><span class="payment_badge payment_badge_red">Disable</span></td><td>',d+='<button type="button" class="btn btn-link btn-sm setting_account_edit" id="'+t[i][0]+'" data-toggle="modal" data-target="#account_edit_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span>&nbsp;Edit</button>',d+='<button type="button" class="btn btn-link btn-sm setting_account_password" id="'+t[i][0]+'" data-toggle="modal" data-target="#account_password_modal"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span>&nbsp;Password</button>',9==o&&(d+='<button type="button" class="btn btn-link btn-sm setting_permission_edit" id="'+t[i][0]+'" data-toggle="modal" data-target="#permission_edit_modal"><span class="glyphicon glyphicon-th-list" aria-hidden="true"></span>&nbsp;Permission</button>',d+='<button type="button" class="btn btn-link btn-sm setting_account_delete" id="'+t[i][0]+'" data-toggle="modal" data-target="#account_delete_modal"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span>&nbsp;Delete</button>'),d+="</td></tr>";else s("account","There is no any account data.");a(".table_account_body").html(d)}else window.location.href="../../admin/login.php";else s("account","Cannot load account list.")},failure:function(a){l("account",!1),s("account","Cannot load account list.")}}))}function p(){l("blockip",!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_blockip_list.php",data:{},success:function(t){if(l("blockip",!1),"error"!=t)if("no_cookie"!=t){var e=jQuery.parseJSON(t),n="";if(e.length>0)for(var d=0;d<e.length;d++)n+="<tr><td>"+(d+1)+"</td>",n+='<td id="ipaddr_'+e[d][0]+'">'+e[d][1]+"</td>",n+='<td id="ipdesc_'+e[d][0]+'">'+e[d][2]+"</td>",9==o&&(n+="<td>",n+='<button type="button" class="btn btn-link btn-sm btn_blockip_edit" id="ipid_'+e[d][0]+'" data-toggle="modal" data-target="#block_ip_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span>&nbsp;Edit</button>',n+='<button type="button" class="btn btn-link btn-sm btn_blockip_delete" id="ipid_'+e[d][0]+'" data-toggle="modal" data-target="#blockip_delete_modal"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span>&nbsp;Delete</button>',n+="</td>"),n+="</tr>";a(".table_blockip_body").html(n)}else window.location.href="../../admin/login.php";else s("account","Cannot load block IP list.")},failure:function(a){l("blockip",!1),s("blockip","Cannot load block IP list.")}})}a.ajax({type:"GET",url:"../daemon/ajax_admin/get_login_user.php",data:{},success:function(a){var t=jQuery.parseJSON(a);o=parseInt(t[2]),_(),p()},failure:function(a){}}),a(".btn_account_add").click(function(){a(".add_user_name").val(""),a(".add_password").val(""),a(".add_repassword").val(""),a(".add_display_name").val(""),a(".add_sms_number").val(""),a(".add_email_address").val(""),a(".add_telegram_bot").val(""),a(".add_role").prop("checked",!1),a(".add_disable_account").prop("checked",!1),a(".add_disable_sms").prop("checked",!1),a(".add_disable_email").prop("checked",!1),a(".add_disable_bot").prop("checked",!1)}),a(".modal_btn_account_add").click(function(){return""==a(".add_user_name").val()?(s("account_add","Please input User ID."),void a(".add_user_name").focus()):""==a(".add_password").val()?(s("account_add","Please input Password."),void a(".add_password").focus()):a(".add_password").val()!=a(".add_repassword").val()?(s("account_add","Doesn't match password."),void a(".add_repassword").focus()):""==a(".add_display_name").val()?(s("account_add","Please input User Name."),void a(".add_display_name").focus()):(a("#account_add_modal").modal("toggle"),void function(){l("account",!0);var t=1==a(".add_disable_account").prop("checked")?0:1,e=1==a(".add_disable_sms").prop("checked")?0:1,n=1==a(".add_disable_email").prop("checked")?0:1,o=1==a(".add_disable_bot").prop("checked")?0:1;a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_account_add.php",data:{user_name:a(".add_user_name").val(),password:a(".add_password").val(),display_name:a(".add_display_name").val(),sms:a(".add_sms_number").val(),email:a(".add_email_address").val(),bot:a(".add_telegram_bot").val(),role:a(".add_role").val(),state:t,enable_sms:e,enable_email:n,enable_bot:o},success:function(a){if(l("account",!1),"success"==a)_();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");s("account","Account cannot be added.")}},failure:function(a){l("account",!1),s("account","Account cannot be added.")}})}())}),a(".table_account_body").on("click",".setting_account_edit",function(n){e=a(this).prop("id");for(var o=0;o<t.length;o++)if(e==t[o][0]){a(".edit_user_name").val(t[o][1]),a(".edit_display_name").val(t[o][3]),a(".edit_role").val(t[o][4]),a(".edit_sms_number").val(t[o][7]),a(".edit_email_address").val(t[o][8]),a(".edit_telegram_bot").val(t[o][9]),a(".edit_disable_account").prop("checked","1"!=t[o][5]),a(".edit_disable_sms").prop("checked","1"!=t[o][10]),a(".edit_disable_email").prop("checked","1"!=t[o][11]),a(".edit_disable_bot").prop("checked","1"!=t[o][12]);break}}),a(".modal_btn_account_edit").click(function(){return""==a(".edit_user_name").val()?(s("account_edit","Please input User ID."),void a(".edit_user_name").focus()):""==a(".edit_display_name").val()?(s("account_edit","Please input User Name."),void a(".edit_display_name").focus()):(a("#account_edit_modal").modal("toggle"),void function(){l("account",!0);var t=1==a(".edit_disable_account").prop("checked")?0:1,n=1==a(".edit_disable_sms").prop("checked")?0:1,o=1==a(".edit_disable_email").prop("checked")?0:1,d=1==a(".edit_disable_bot").prop("checked")?0:1;a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_account_edit.php",data:{account_id:e,user_name:a(".edit_user_name").val(),display_name:a(".edit_display_name").val(),sms:a(".edit_sms_number").val(),email:a(".edit_email_address").val(),bot:a(".edit_telegram_bot").val(),role:a(".edit_role").val(),state:t,enable_sms:n,enable_email:o,enable_bot:d},success:function(a){l("account",!1),"success"==a?_():"no_cookie"==a?window.location.href="../../admin/login.php":s("account","Account cannot be changed.")},failure:function(a){l("account",!1),s("account","Account cannot be changed.")}})}())}),a(".table_account_body").on("click",".setting_account_password",function(t){e=a(this).prop("id"),a(".edit_password").val(""),a(".edit_repassword").val("")}),a(".modal_btn_account_password").click(function(){return""==a(".edit_password").val()?(s("account_password","Please input New Password."),void a(".edit_password").focus()):a(".edit_password").val()!=a(".edit_repassword").val()?(s("account_password","Doesn't match password."),void a(".edit_repassword").focus()):(a("#account_password_modal").modal("toggle"),l("account",!0),void a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_account_password.php",data:{account_id:e,password:a(".edit_password").val()},success:function(a){if(l("account",!1),"success"==a)_();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");s("account","Account Password cannot be changed.")}},failure:function(a){l("account",!1),s("account","Account Password cannot be changed.")}}))}),a(".table_account_body").on("click",".setting_account_delete",function(t){e=a(this).prop("id")}),a(".modal_btn_account_delete").click(function(){a("#account_delete_modal").modal("toggle"),l("account",!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_account_delete.php",data:{account_id:e},success:function(a){if(l("account",!1),"success"==a)_();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");s("account","Account cannot be deleted.")}},failure:function(a){l("account",!1),s("account","Account cannot be deleted.")}})}),a(".table_account_body").on("click",".setting_permission_edit",function(t){e=a(this).prop("id"),a("#permission_all").prop("checked",!1),a(".permission_item").each(function(t){a(this).prop("checked",!1)}),function(){if(d)return;l("account",!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_permission_list.php",data:{account_id:e},success:function(t){if(l("account",!1),"error"!=t)if("no_cookie"!=t){var e=jQuery.parseJSON(t),n=e[2].length,o="";if(n>0){for(var d=0;d<n;d++){var i="1"==e[2][d][2]?"checked":"";o+="<tr>",o+="<td>"+(d+1)+"</td>",o+="<td>"+e[2][d][1]+"</td>",o+='<td><input id="permission_'+e[2][d][0]+'" type="checkbox" class="permission_item" style="margin:0;padding:0" '+i+"></input></td>",o+="</tr>"}a(".table_permission_body").html(o)}}else window.location.href="../../admin/login.php";else s("account","Cannot load account permission list.")},failure:function(a){l("account",!1),s("account","Cannot load account permission list.")}})}()}),a(".modal_btn_permission_edit").click(function(){var t,n="";a(".permission_item").each(function(t){a(this).prop("checked")&&(""!=n&&(n+=","),n+=a(this).prop("id").substring(11))}),a("#permission_edit_modal").modal("toggle"),t=n,l("account",!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_permission_edit.php",data:{account_id:e,permissions:t},success:function(a){l("account",!1),"error"!=a?"no_cookie"!=a||(window.location.href="../../admin/login.php"):s("account","CRM permission cannot be changed.")},failure:function(a){l("account",!1),s("account","CRM permission cannot be changed.")}})}),a("#permission_all").click(function(){a(".permission_item").each(function(t){a("#permission_all").prop("checked")?a(this).prop("checked",!0):a(this).prop("checked",!1)})}),a(".btn_blockip_add").click(function(){c="add",a(".ip_address").val(""),a(".ip_description").val("")}),a(".modal_btn_blockip_apply").click(function(){if(""==a(".ip_address").val())return s("blockip_modal","Please input IP Address."),void a(".ip_address").focus();a("#block_ip_modal").modal("toggle"),"add"==c?(l("blockip",!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_blockip_add.php",data:{block_ip:a(".ip_address").val(),description:a(".ip_description").val()},success:function(a){if(l("blockip",!1),"success"==a)p();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");s("blockip","Block IP cannot be added.")}},failure:function(a){l("blockip",!1),s("blockip","Block IP cannot be added.")}})):"edit"==c&&(l("blockip",!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_blockip_edit.php",data:{ip_id:n,block_ip:a(".ip_address").val(),description:a(".ip_description").val()},success:function(a){if(l("blockip",!1),"success"==a)p();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");s("blockip","Block IP cannot be changed.")}},failure:function(a){l("blockip",!1),s("blockip","Block IP cannot be changed.")}}))}),a(".table_blockip_body").on("click",".btn_blockip_edit",function(t){c="edit",n=a(this).prop("id").substring(5);var e=a("#ipaddr_"+n).html(),o=a("#ipdesc_"+n).html();a(".ip_address").val(e),a(".ip_description").val(o)}),a(".table_blockip_body").on("click",".btn_blockip_delete",function(t){n=a(this).prop("id").substring(5)}),a(".modal_btn_blockip_delete").click(function(){a("#blockip_delete_modal").modal("toggle"),l("blockip",!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_blockip_delete.php",data:{ip_id:n},success:function(a){if(l("blockip",!1),"success"==a)p();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");s("blockip","Block IP cannot be deleted.")}},failure:function(a){l("blockip",!1),s("blockip","Block IP cannot be deleted.")}})})});