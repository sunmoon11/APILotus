jQuery(document).ready(function(a){function d(){a.ajax({type:"GET",url:"../daemon/ajax_admin/get_login_user.php",data:{},success:function(a){var d=jQuery.parseJSON(a);m=parseInt(d[2]),s()},failure:function(a){}})}function e(d,e){"main"==d?(a(".setting_crm_alert").html(e),a(".setting_crm_alert").fadeIn(1e3,function(){a(".setting_crm_alert").fadeOut(3e3)})):"add"==d?(a(".crm_add_alert").html(e),a(".crm_add_alert").fadeIn(1e3,function(){a(".crm_add_alert").fadeOut(3e3)})):"edit"==d?(a(".crm_edit_alert").html(e),a(".crm_edit_alert").fadeIn(1e3,function(){a(".crm_edit_alert").fadeOut(3e3)})):"crm_password"==d?(a(".crm_password_alert").html(e),a(".crm_password_alert").fadeIn(1e3,function(){a(".crm_password_alert").fadeOut(3e3)})):"api_password"==d&&(a(".api_password_alert").html(e),a(".api_password_alert").fadeIn(1e3,function(){a(".api_password_alert").fadeOut(3e3)}))}function t(d){(l=d)?a(".setting_crm_waiting").html(p):a(".setting_crm_waiting").html("")}function s(){l||(t(!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_crm_list.php",data:{},success:function(d){if(t(!1),"error"!=d)if("no_cookie"!=d){var s=jQuery.parseJSON(d),i=s.length,n="";if(i>0)for(var r=0;r<i;r++){if(n+="<tr><td>"+(r+1)+"</td>",n+='<td id="name_'+s[r][0]+'">'+s[r][1]+"</td>",n+='<td id="url_'+s[r][0]+'">'+s[r][2]+"</td>",n+='<td id="id1_'+s[r][0]+'">'+s[r][3]+"</td>",n+='<td id="pass1_'+s[r][0]+'">'+s[r][4]+"</td>",n+='<td id="id2_'+s[r][0]+'">'+s[r][5]+"</td>",n+='<td id="pass2_'+s[r][0]+'">'+s[r][6]+"</td>",n+='<td id="goal_'+s[r][0]+'">'+s[r][7]+"</td>","1"==s[r][8]?n+='<td id="paused_'+s[r][0]+'"><span class="payment_badge payment_badge_red">Paused</span></td>':n+='<td id="paused_'+s[r][0]+'"></td>',"0000-00-00"==s[r][9]||null==s[r][9])n+='<td id="valid_'+s[r][0]+'"><span class="payment_badge payment_badge_red">No set password date</span></td>';else{var _=s[r][9].split("-"),o=s[r][10].split("-"),c=Date.UTC(_[0],_[1]-1,_[2]),l=Date.UTC(o[0],o[1]-1,o[2]),m=30-Math.abs((c.valueOf()-l.valueOf())/864e5);m<0&&(m=0),n+=m<5?'<td id="valid_'+s[r][0]+'"><span class="payment_badge payment_badge_red">'+m+"</span></td>":'<td id="valid_'+s[r][0]+'">'+m+"</td>"}n+="<td>",n+='<button type="button" class="btn btn-link btn-sm setting_crm_edit" id="'+s[r][0]+'" data-toggle="modal" data-target="#crm_edit_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span>&nbsp;Edit</button>',n+='<button type="button" class="btn btn-link btn-sm setting_crm_password" id="'+s[r][0]+'" data-toggle="modal" data-target="#crm_password_modal"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span>&nbsp;CRM Password</button>',n+='<button type="button" class="btn btn-link btn-sm setting_api_password" id="'+s[r][0]+'" data-toggle="modal" data-target="#api_password_modal"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span>&nbsp;API Password</button>',n+='<button type="button" class="btn btn-link btn-sm setting_crm_delete" id="'+s[r][0]+'" data-toggle="modal" data-target="#crm_delete_modal"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span>&nbsp;Delete</button>',n+="</td></tr>"}else e("main","There is no any crm data.");a(".table_crm_body").html(n)}else window.location.href="../../admin/login.php";else e("main","Cannot load CRM list.")},failure:function(a){t(!1),e("main","Cannot load CRM list.")}}))}function i(){t(!0);var d=0;a(".add_crm_paused").prop("checked")&&(d=1),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_crm_add.php",data:{crm_name:a(".add_crm_name").val(),crm_url:a(".add_crm_url").val(),crm_username:a(".add_crm_username").val(),crm_password:a(".add_crm_password").val(),api_username:a(".add_api_username").val(),api_password:a(".add_api_password").val(),sales_goal:a(".add_sales_goal").val(),crm_paused:d},success:function(a){if(t(!1),"success"==a)s();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");e("main","CRM cannot be added.")}},failure:function(a){t(!1),e("main","CRM cannot be added.")}})}function n(){t(!0);var d=0;a(".edit_crm_paused").prop("checked")&&(d=1),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_crm_edit.php",data:{crm_id:c,crm_name:a(".edit_crm_name").val(),crm_url:a(".edit_crm_url").val(),crm_username:a(".edit_crm_username").val(),api_username:a(".edit_api_username").val(),sales_goal:a(".edit_sales_goal").val(),crm_paused:d},success:function(a){if(t(!1),"success"==a)s();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");e("main","CRM information cannot be changed.")}},failure:function(a){t(!1),e("main","CRM information cannot be changed.")}})}function r(){t(!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_crm_crmpass.php",data:{crm_id:c,crm_password:a(".edit_crm_password").val()},success:function(a){if(t(!1),"success"==a)s();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");e("main","CRM Password cannot be changed.")}},failure:function(a){t(!1),e("main","CRM Password cannot be changed.")}})}function _(){t(!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_crm_apipass.php",data:{crm_id:c,api_password:a(".edit_api_password").val()},success:function(a){if(t(!1),"success"==a)s();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");e("main","API Password cannot be changed.")}},failure:function(a){t(!1),e("main","API Password cannot be changed.")}})}function o(){t(!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_crm_delete.php",data:{crm_id:c},success:function(a){if(t(!1),"success"==a)s();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");e("main","CRM cannot be deleted.")}},failure:function(a){t(!1),e("main","CRM cannot be deleted.")}})}var c=-1,l=!1,m=0,p='<img src="../images/loading.gif" style="width:22px;height:22px;">';d(),a(".btn_crm_add").click(function(){a(".add_crm_name").val(""),a(".add_crm_url").val(""),a(".add_crm_username").val(""),a(".add_crm_password").val(""),a(".add_crm_repassword").val(""),a(".add_api_username").val(""),a(".add_api_password").val(""),a(".add_api_repassword").val(""),a(".add_sales_goal").val(""),a(".add_crm_paused").prop("checked",!1)}),a(".modal_btn_crm_add").click(function(){return""==a(".add_crm_name").val()?(e("add","Please input CRM Name."),void a(".add_crm_name").focus()):""==a(".add_crm_url").val()?(e("add","Please input CRM Site URL."),void a(".add_crm_url").focus()):""==a(".add_crm_username").val()?(e("add","Please input CRM User Name."),void a(".add_crm_username").focus()):""==a(".add_crm_password").val()?(e("add","Please input CRM Password."),void a(".add_crm_password").focus()):a(".add_crm_password").val()!=a(".add_crm_repassword").val()?(e("add","Doesn't match CRM Password."),void a(".add_crm_repassword").focus()):""==a(".add_api_username").val()?(e("add","Please input API User Name."),void a(".add_api_username").focus()):""==a(".add_api_password").val()?(e("add","Please input API Password."),void a(".add_api_password").focus()):a(".add_api_password").val()!=a(".add_api_repassword").val()?(e("add","Doesn't match API Password."),void a(".add_api_repassword").focus()):""==a(".add_sales_goal").val()?(e("add","Please input Sales Goal."),void a(".add_sales_goal").focus()):(a("#crm_add_modal").modal("toggle"),void i())}),a(".table_crm_body").on("click",".setting_crm_edit",function(d){c=a(this).prop("id"),a(".edit_crm_name").val(a("#name_"+c).text()),a(".edit_crm_url").val(a("#url_"+c).text()),a(".edit_crm_username").val(a("#id1_"+c).text()),a(".edit_api_username").val(a("#id2_"+c).text()),a(".edit_sales_goal").val(a("#goal_"+c).text()),"Paused"==a("#paused_"+c).text()?a(".edit_crm_paused").prop("checked",!0):a(".edit_crm_paused").prop("checked",!1)}),a(".modal_btn_crm_edit").click(function(){return""==a(".edit_crm_name").val()?(e("edit","Please input CRM Name."),void a(".edit_crm_name").focus()):""==a(".edit_crm_url").val()?(e("edit","Please input CRM Site URL."),void a(".edit_crm_url").focus()):""==a(".edit_crm_username").val()?(e("edit","Please input CRM User Name."),void a(".edit_crm_username").focus()):""==a(".edit_api_username").val()?(e("edit","Please input API User Name."),void a(".edit_api_username").focus()):""==a(".edit_sales_goal").val()?(e("edit","Please input Sales Goal."),void a(".edit_sales_goal").focus()):(a("#crm_edit_modal").modal("toggle"),void n())}),a(".table_crm_body").on("click",".setting_crm_password",function(d){c=a(this).prop("id"),a(".edit_crm_password").val(""),a(".edit_crm_repassword").val("")}),a(".modal_btn_crm_password").click(function(){return""==a(".edit_crm_password").val()?(e("crm_password","Please input CRM Password."),void a(".edit_crm_password").focus()):a(".edit_crm_password").val()!=a(".edit_crm_repassword").val()?(e("crm_password","Doesn't match CRM Password."),void a(".edit_crm_repassword").focus()):(a("#crm_password_modal").modal("toggle"),void r())}),a(".table_crm_body").on("click",".setting_api_password",function(d){c=a(this).prop("id"),a(".edit_api_password").val(""),a(".edit_api_repassword").val("")}),a(".modal_btn_api_password").click(function(){return""==a(".edit_api_password").val()?(e("api_password","Please input API Password."),void a(".edit_api_password").focus()):a(".edit_api_password").val()!=a(".edit_api_repassword").val()?(e("api_password","Doesn't match API Password."),void a(".edit_api_repassword").focus()):(a("#api_password_modal").modal("toggle"),void _())}),a(".table_crm_body").on("click",".setting_crm_delete",function(d){c=a(this).prop("id")}),a(".modal_btn_crm_delete").click(function(){a("#crm_delete_modal").modal("toggle"),o()})});