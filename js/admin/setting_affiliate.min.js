jQuery(document).ready(function(a){function t(t,i){"main"==t?(a(".setting_affiliate_alert").html(i),a(".setting_affiliate_alert").fadeIn(1e3,function(){a(".setting_affiliate_alert").fadeOut(3e3)})):"add"==t?(a(".label_add_alert").html(i),a(".label_add_alert").fadeIn(1e3,function(){a(".label_add_alert").fadeOut(3e3)})):"edit"==t&&(a(".label_edit_alert").html(i),a(".label_edit_alert").fadeIn(1e3,function(){a(".label_edit_alert").fadeOut(3e3)}))}function i(t){(p=t)?a(".setting_affiliate_waiting p").html(m):a(".setting_affiliate_waiting").html("<p></p>")}function e(){p||(i(!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/crm_list.php",data:{},success:function(e){if(i(!1),"error"!=e)if("no_cookie"!=e){var n=(s=jQuery.parseJSON(e)).length,d="";if(d+="<tr>",d+='<th rowspan="2" style="vertical-align:middle">Affiliate ID</th>',d+='<th rowspan="2" style="border-right: 1px solid #dadada; vertical-align:middle">Affiliate Label</th>',d+='<th colspan="'+n+'">Goals</th>',d+='<th rowspan="2" style="border-left: 1px solid #dadada; vertical-align:middle">Action</th>',d+="</tr>",n>0)for(var o=0;o<n;o++)d+="<th>"+s[o][1]+"</th>";else t("main","There is no any crm data.");a(".table_affiliate_head").html(d),n>0&&l()}else window.location.href="../../admin/login.php";else t("main","Cannot load CRM list.")},failure:function(a){i(!1),t("main","Cannot load CRM list.")}}))}function l(){p||(i(!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_affiliate_list.php",data:{page_number:_,items_page:c},success:function(e){if(i(!1),"error"!=e)if("no_cookie"!=e){var l=jQuery.parseJSON(e),d="";u=l.length;var o=l.affiliates.length;if(o>0)for(_=0;_<o;_++){d+="<tr>",d+='<td id="aid_'+l.affiliates[_][0]+'">'+l.affiliates[_][0]+"</td>",d+='<td id="alabel_'+l.affiliates[_][0]+'" style="border-right: 1px solid #dadada">'+l.affiliates[_][1]+"</td>";for(var f=0;f<s.length;f++)d+='<td id="goal_'+l.affiliates[_][0]+"_"+s[f][0]+'"></td>';d+='<td style="border-left: 1px solid #dadada">',d+='<button type="button" class="btn btn-link btn-sm btn_affiliate_edit" id="'+l.affiliates[_][0]+'" data-toggle="modal" data-target="#affiliate_edit_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span>&nbsp;Edit</button>',d+='<button type="button" class="btn btn-link btn-sm btn_affiliate_delete" id="'+l.affiliates[_][0]+'" data-toggle="modal" data-target="#affiliate_delete_modal"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span>&nbsp;Delete</button>',d+="</td></tr>"}else t("main","There is no any affiliate data.");if(a(".table_affiliate_body").html(d),o>0)for(var _=0;_<o;_++)for(var c=0;c<l.affiliates[_][2].length;c++)a("#goal_"+l.affiliates[_][0]+"_"+l.affiliates[_][2][c][0]).html(l.affiliates[_][2][c][1]);n()}else window.location.href="../../admin/login.php";else t("main","Cannot load affiliate list.")},failure:function(a){i(!1),t("main","Cannot load affiliate list.")}}))}function n(){var t="",i="";if(u>0){var e=Math.floor((_-1)/r),l=e*r+1,n=(e+1)*r;n*c>u&&(n=Math.floor(u/c),u%c>0&&n++);for(var d=l;d<=n;d++)t+=d==_?'<button type="button" class="btn btn-success btn-sm affiliate_page" id="page_'+d+'">'+d+"</button>":'<button type="button" class="btn btn-default btn-sm affiliate_page" id="page_'+d+'">'+d+"</button>";e>0&&(i+='<button type="button" class="btn btn-default btn-sm affiliate_page" id="page_first">&lt;&lt;</button><button type="button" class="btn btn-default btn-sm affiliate_page" id="page_prev">&lt;</button>'),i+=t,n*c<u&&(i+='<button type="button" class="btn btn-default btn-sm affiliate_page" id="page_next">&gt;</button><button type="button" class="btn btn-default btn-sm affiliate_page" id="page_last">&gt;&gt;</button>')}a(".affiliate_pagination").html(i)}function d(l,n,d,o){i(!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_affiliate_add.php",data:{affiliate_id:l,affiliate_label:n,crm_ids:d,goals:o},success:function(a){if(i(!1),"success"==a)e();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");t("main","Affiliate cannot be added.")}},failure:function(a){i(!1),t("main","Affiliate cannot be added.")}})}function o(l,n,d,o){i(!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_affiliate_edit.php",data:{affiliate_id:l,affiliate_label:n,crm_ids:d,goals:o},success:function(a){if(i(!1),"success"==a)e();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");t("main","Affiliate cannot be changed.")}},failure:function(a){i(!1),t("main","Affiliate cannot be changed.")}})}function f(){i(!0),a.ajax({type:"GET",url:"../daemon/ajax_admin/setting_affiliate_delete.php",data:{affiliate_id:b},success:function(a){if(i(!1),"success"==a)e();else{if("no_cookie"==a)return void(window.location.href="../../admin/login.php");t("main","Affiliate cannot be deleted.")}},failure:function(a){i(!1),t("main","Affiliate cannot be deleted.")}})}var s,_=1,c=10,r=7,u=0,p=!1,b=-1,m='<img src="../images/loading.gif" style="width:22px;height:22px;">';e(),a(".btn_affiliate_add").click(function(){var t="";t+='<div class="alert alert-warning label_add_alert" role="alert" style="display:none"></div>',t+='<div class="row" style="margin-bottom:5px;">',t+='<div class="col-xs-4 modal_input_label">Affiliate ID</div>',t+='<div class="col-xs-8"><input type="text" class="form-control input-sm add_affiliate_id"></div>',t+="</div>",t+='<div class="row" style="margin-bottom:5px;">',t+='<div class="col-xs-4 modal_input_label">Affiliate Label</div>',t+='<div class="col-xs-8"><input type="text" class="form-control input-sm add_affiliate_label"></div>',t+="</div>";for(var i=0;i<s.length;i++)t+='<div class="row" style="margin-bottom:5px;">',t+='<div class="col-xs-4 modal_input_label">'+s[i][1]+" Goal</div>",t+='<div class="col-xs-8"><input type="text" id="addgoal_'+s[i][0]+'" class="form-control input-sm add_goals"></div>',t+="</div>";a(".affiliate_add_body").html(t)}),a(".modal_btn_label_add").click(function(){if(""==a(".add_affiliate_id").val())return t("add","Please input Affiliate ID."),void a(".add_affiliate_id").focus();var i="",e="";a(".add_goals").each(function(t){""!=i&&(i+=","),""!=e&&(e+=","),i+=a(this).prop("id").substring(8),""==a(this).val()?e+="0":e+=a(this).val()}),a("#affiliate_add_modal").modal("toggle"),d(a(".add_affiliate_id").val(),a(".add_affiliate_label").val(),i,e)}),a(".table_affiliate_body").on("click",".btn_affiliate_edit",function(t){b=a(this).prop("id");var i="";i+='<div class="alert alert-warning label_edit_alert" role="alert" style="display:none"></div>',i+='<div class="row" style="margin-bottom:5px;">',i+='<div class="col-xs-4 modal_input_label">Affiliate ID</div>',i+='<div class="col-xs-8"><input type="text" class="form-control input-sm edit_affiliate_id" value="'+a("#aid_"+b).text()+'" readonly></div>',i+="</div>",i+='<div class="row" style="margin-bottom:5px;">',i+='<div class="col-xs-4 modal_input_label">Affiliate Label</div>',i+='<div class="col-xs-8"><input type="text" class="form-control input-sm edit_affiliate_label" value="'+a("#alabel_"+b).text()+'"></div>',i+="</div>";for(var e=0;e<s.length;e++)i+='<div class="row" style="margin-bottom:5px;">',i+='<div class="col-xs-4 modal_input_label">'+s[e][1]+" Goal</div>",i+='<div class="col-xs-8"><input type="text" id="editgoal_'+s[e][0]+'" class="form-control input-sm edit_goals" value="'+a("#goal_"+b+"_"+s[e][0]).text()+'"></div>',i+="</div>";a(".affiliate_edit_body").html(i)}),a(".modal_btn_label_edit").click(function(){if(""==a(".edit_affiliate_id").val())return t("edit","Please input Affiliate ID."),void a(".edit_affiliate_id").focus();var i="",e="";a(".edit_goals").each(function(t){""!=i&&(i+=","),""!=e&&(e+=","),i+=a(this).prop("id").substring(9),""==a(this).val()?e+="0":e+=a(this).val()}),a("#affiliate_edit_modal").modal("toggle"),o(a(".edit_affiliate_id").val(),a(".edit_affiliate_label").val(),i,e)}),a(".table_affiliate_body").on("click",".btn_affiliate_delete",function(t){b=a(this).prop("id")}),a(".modal_btn_label_delete").click(function(){a("#affiliate_delete_modal").modal("toggle"),f()}),a(".btn_export").click(function(){window.location.href="./export_excel_affiliate.php"}),a(".affiliate_pagination").on("click",".affiliate_page",function(t){var i=a(this).prop("id").substring(5),l=Math.floor((_-1)/r);"first"==i?_=1:"prev"==i?_=(l-1)*r+1:"next"==i?_=(l+1)*r+1:"last"==i?(_=Math.floor(u/c),u%c>0&&_++):_=i,e()}),a(".count_dropdown_menu li").on("click",function(t){c=a(this).text(),a(".count_toggle_button").html(c+' <span class="caret"></span>'),_=1,e()})});