jQuery(document).ready(function(e){function a(){e(".crm_dropdown_list").length>0&&(m=e(".crm_dropdown_list").prop("id"))}function l(a,l){"campaign"==a?(e(".setting_campaign_alert").html(l),e(".setting_campaign_alert").fadeIn(1e3,function(){e(".setting_campaign_alert").fadeOut(3e3)})):"label"==a?(e(".setting_label_alert").html(l),e(".setting_label_alert").fadeIn(1e3,function(){e(".setting_label_alert").fadeOut(3e3)})):"label_add"==a?(e(".label_add_alert").html(l),e(".label_add_alert").fadeIn(1e3,function(){e(".label_add_alert").fadeOut(3e3)})):"label_edit"==a?(e(".label_edit_alert").html(l),e(".label_edit_alert").fadeIn(1e3,function(){e(".label_edit_alert").fadeOut(3e3)})):"action_edit"==a&&(e(".action_edit_alert").html(l),e(".action_edit_alert").fadeIn(1e3,function(){e(".action_edit_alert").fadeOut(3e3)}))}function t(a,l){"campaign"==a?(v=l)?e(".setting_campaign_waiting").html(C):e(".setting_campaign_waiting").html(""):"label"==a&&((w=l)?e(".setting_label_waiting").html(C):e(".setting_label_waiting").html(""))}function n(){v||-1==m||(t("campaign",!0),e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_campaign_list.php",data:{crm_id:m,campaign_ids:e(".search_campaign_ids").val(),page_number:u,items_page:h},success:function(a){if(t("campaign",!1),"error"!=a)if("no_cookie"!=a){var n=jQuery.parseJSON(a),c="";k=n.length;var o=n.ids.length;if(o>0)for(var d=0;d<o;d++)c+='<tr><td><input type="checkbox" id="campaign_'+n.ids[d]+'" class="campaign_item"></td>',c+="<td>"+n.ids[d]+"</td>",c+="<td>"+n.names[d]+"</td>",c+="<td>"+n.labels[d]+"</td></tr>";else l("campaign","There is no any campaign data.");e(".table_campaign_body").html(c),e(".campagin_select_all").prop("checked",!1),i()}else window.location.href="../../admin/login.php";else l("campaign","Cannot load campaign list.")},failure:function(e){t("campaign",!1),l("campaign","Cannot load campaign list.")}}),c())}function i(){var a="",l="";if(k>0){var t=Math.floor((u-1)/f),n=t*f+1,i=(t+1)*f;i*h>k&&(i=Math.floor(k/h),k%h>0&&i++);for(var c=n;c<=i;c++)a+=c==u?'<button type="button" class="btn btn-success btn-sm campaign_page" id="page_'+c+'">'+c+"</button>":'<button type="button" class="btn btn-default btn-sm campaign_page" id="page_'+c+'">'+c+"</button>";t>0&&(l+='<button type="button" class="btn btn-default btn-sm campaign_page" id="page_first">&lt;&lt;</button><button type="button" class="btn btn-default btn-sm campaign_page" id="page_prev">&lt;</button>'),l+=a,i*h<k&&(l+='<button type="button" class="btn btn-default btn-sm campaign_page" id="page_next">&gt;</button><button type="button" class="btn btn-default btn-sm campaign_page" id="page_last">&gt;&gt;</button>')}e(".campaign_pagination").html(l)}function c(){w||(t("label",!0),""!=g&&e("#crm_name_4vertical").html(g),e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_campaign_label_list.php",data:{crm_id:m},success:function(a){if(t("label",!1),"error"!=a)if("no_cookie"!=a){var n=jQuery.parseJSON(a),i="";k=n.length,s=n;var c=1;if(k>0)for(var o=0;o<k;o++)"3"==n[o][2]&&(i+="<tr><td>"+c+"</td>",i+='<td id="lname_'+n[o][0]+'">'+n[o][1]+"</td>",i+='<td id="lgoal_'+n[o][0]+'">'+n[o][3]+"</td>",i+='<td id="lshow_'+n[o][0]+'">'+("1"==n[o][4]?j:"")+"</td>",i+='<td><button type="button" class="btn btn-link btn-sm setting_label_edit" id="ledit_'+n[o][0]+'" data-toggle="modal" data-target="#campaign_label_edit_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span>&nbsp;Edit</button>',i+='<button type="button" class="btn btn-link btn-sm setting_label_delete" id="ldelete_'+n[o][0]+'" data-toggle="modal" data-target="#campaign_label_delete_modal"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span>&nbsp;Delete</button></td></tr>',c++);else l("label","There is no any label list.");e(".table_label_body").html(i)}else window.location.href="../../admin/login.php";else l("label","Cannot load label list.")},failure:function(e){t("label",!1),l("label","Cannot load label list.")}}))}function o(){t("label",!0),e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_campaign_label_add.php",data:{label_name:e(".add_label_name").val()},success:function(e){if(t("label",!1),"success"==e)c();else{if("no_cookie"==e)return void(window.location.href="../../admin/login.php");l("label","Campaign label cannot be added.")}},failure:function(e){t("label",!1),l("label","Campaign label cannot be added.")}})}function d(){t("label",!0),e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_campaign_label_edit.php",data:{crm_id:m,label_id:y,label_name:e(".edit_label_name").val(),label_show:1==e(".edit_label_show").prop("checked")?"1":"0",label_goal:e(".edit_label_goal").val()},success:function(e){if(t("label",!1),"success"==e)c();else{if("no_cookie"==e)return void(window.location.href="../../admin/login.php");l("label","Campaign label cannot be changed.")}},failure:function(e){t("label",!1),l("label","Campaign label cannot be changed.")}})}function _(){t("label",!0),e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_campaign_label_delete.php",data:{label_id:y},success:function(e){if(t("label",!1),"success"==e)c();else{if("no_cookie"==e)return void(window.location.href="../../admin/login.php");l("label","Campaign label cannot be deleted.")}},failure:function(e){t("label",!1),l("label","Campaign label cannot be deleted.")}})}function p(){var a="";return e(".campaign_item").each(function(l){e(this).prop("checked")&&(""!=a&&(a+=","),a+=e(this).prop("id").substring(9))}),a}function b(a){t("campaign",!0),e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_campaign_action_edit.php",data:{crm_id:m,campaign_ids:x,label_ids:a},success:function(e){if(t("campaign",!1),"success"==e)n();else{if("no_cookie"==e)return void(window.location.href="../../admin/login.php");l("campaign","Campaign label cannot be changed.")}},failure:function(e){t("campaign",!1),l("campaign","Campaign label cannot be changed.")}})}function r(){t("campaign",!0),e.ajax({type:"GET",url:"../daemon/ajax_admin/setting_campaign_action_delete.php",data:{crm_id:m,campaign_ids:x},success:function(e){if(t("campaign",!1),"success"==e)n();else{if("no_cookie"==e)return void(window.location.href="../../admin/login.php");l("campaign","Campaign label cannot be deleted.")}},failure:function(e){t("campaign",!1),l("campaign","Campaign label cannot be deleted.")}})}var s,m=-1,g="",u=1,h=10,f=7,k=0,v=!1,y=-1,w=!1,x="",j="&#10003;",C='<img src="../images/loading.gif" style="width:22px;height:22px;">';a(),n(),e(".campagin_select_all").click(function(){e(".campaign_item").each(function(a){e(".campagin_select_all").prop("checked")?e(this).prop("checked",!0):e(this).prop("checked",!1)})}),e(".crm_dropdown_menu li").on("click",function(a){g=e(this).text(),m=e(this).find("a").attr("id"),e(".crm_toggle_button").html(g+' <span class="caret"></span>')}),e(".campaign_action_dropdown_menu li").on("click",function(a){var t=e(this).find("a").attr("id");if(""!=(x=p()))if("action_edit"==t){e(".modal_tlabel_item").each(function(a){e(this).prop("checked",!1)}),e("#tlabel_11").prop("checked",!1),e("#tlabel_12").prop("checked",!1),e("#tlabel_21").prop("checked",!1),e("#tlabel_22").prop("checked",!1),e("#tlabel_41").prop("checked",!1),e("#tlabel_42").prop("checked",!1);for(var n="",i=0;i<s.length;i++)"3"==s[i][2]&&(n+='<tr><td><input type="radio" id="vlabel_'+s[i][0]+'" class="modal_vlabel_item" name="vertical"></td>',n+="<td>"+s[i][1]+"</td></tr>");e(".modal_vlabel_body").html(n),e("#campaign_action_edit_modal").modal("toggle")}else"action_delete"==t&&e("#campaign_action_delete_modal").modal("toggle");else l("campaign","Please select campaign items.")}),e(".modal_tlabel_item").click(function(){e("#tlabel_11").prop("checked",!1),e("#tlabel_12").prop("checked",!1),e("#tlabel_21").prop("checked",!1),e("#tlabel_22").prop("checked",!1),e("#tlabel_41").prop("checked",!1),e("#tlabel_42").prop("checked",!1)}),e("#tlabel_11").click(function(){e("#tlabel_1").prop("checked",!0),e("#tlabel_12").prop("checked",!1),e("#tlabel_21").prop("checked",!1),e("#tlabel_22").prop("checked",!1),e("#tlabel_41").prop("checked",!1),e("#tlabel_42").prop("checked",!1)}),e("#tlabel_12").click(function(){e("#tlabel_1").prop("checked",!0),e("#tlabel_11").prop("checked",!1),e("#tlabel_21").prop("checked",!1),e("#tlabel_22").prop("checked",!1),e("#tlabel_41").prop("checked",!1),e("#tlabel_42").prop("checked",!1)}),e("#tlabel_21").click(function(){e("#tlabel_2").prop("checked",!0),e("#tlabel_11").prop("checked",!1),e("#tlabel_12").prop("checked",!1),e("#tlabel_22").prop("checked",!1),e("#tlabel_41").prop("checked",!1),e("#tlabel_42").prop("checked",!1)}),e("#tlabel_22").click(function(){e("#tlabel_2").prop("checked",!0),e("#tlabel_11").prop("checked",!1),e("#tlabel_12").prop("checked",!1),e("#tlabel_21").prop("checked",!1),e("#tlabel_41").prop("checked",!1),e("#tlabel_42").prop("checked",!1)}),e("#tlabel_41").click(function(){e("#tlabel_4").prop("checked",!0),e("#tlabel_11").prop("checked",!1),e("#tlabel_12").prop("checked",!1),e("#tlabel_21").prop("checked",!1),e("#tlabel_22").prop("checked",!1),e("#tlabel_42").prop("checked",!1)}),e("#tlabel_42").click(function(){e("#tlabel_4").prop("checked",!0),e("#tlabel_11").prop("checked",!1),e("#tlabel_12").prop("checked",!1),e("#tlabel_21").prop("checked",!1),e("#tlabel_22").prop("checked",!1),e("#tlabel_41").prop("checked",!1)}),e(".modal_btn_action_edit").click(function(){var a="",t="";e(".modal_tlabel_item").each(function(l){e(this).prop("checked")&&("1"==(a=e(this).prop("id").substring(7))?e("#tlabel_11").prop("checked")?a="1,5":e("#tlabel_12").prop("checked")&&(a="1,6"):"2"==a?e("#tlabel_21").prop("checked")?a="2,5":e("#tlabel_22").prop("checked")&&(a="2,6"):"4"==a&&(e("#tlabel_41").prop("checked")?a="4,1":e("#tlabel_42").prop("checked")&&(a="4,2")))}),""!=a?(e(".modal_vlabel_item").each(function(a){e(this).prop("checked")&&(t=e(this).prop("id").substring(7))}),""!=t?(e("#campaign_action_edit_modal").modal("toggle"),b(a+","+t)):l("action_edit","Please select vertical label.")):l("action_edit","Please select campaign type.")}),e(".modal_btn_action_delete").click(function(){e("#campaign_action_delete_modal").modal("toggle"),r()}),e(".count_dropdown_menu li").on("click",function(a){h=e(this).text(),e(".count_toggle_button").html(h+' <span class="caret"></span>'),u=1,n()}),e(".campaign_search_button").click(function(){u=1,n()}),e(".campaign_pagination").on("click",".campaign_page",function(a){var l=e(this).prop("id").substring(5),t=Math.floor((u-1)/f);"first"==l?u=1:"prev"==l?u=(t-1)*f+1:"next"==l?u=(t+1)*f+1:"last"==l?(u=Math.floor(k/h),k%h>0&&u++):u=l,n()}),e(".btn_label_add").click(function(){e(".add_label_name").val("")}),e(".modal_btn_label_add").click(function(){if(""==e(".add_label_name").val())return l("label_add","Please input Label Name."),void e(".add_label_name").focus();e("#campaign_label_add_modal").modal("toggle"),o()}),e(".table_label_body").on("click",".setting_label_edit",function(a){y=e(this).prop("id").substring(6),e(".edit_label_name").val(e("#lname_"+y).text()),e(".edit_label_goal").val(e("#lgoal_"+y).text()),e(".edit_label_show").prop("checked",""!=e("#lshow_"+y).text())}),e(".modal_btn_label_edit").click(function(){return""==e(".edit_label_name").val()?(l("label_edit","Please input Label Name."),void e(".edit_label_name").focus()):""==e(".edit_label_goal").val()?(l("label_edit","Please input Label Goal."),void e(".edit_label_goal").focus()):(e("#campaign_label_edit_modal").modal("toggle"),void d())}),e(".table_label_body").on("click",".setting_label_delete",function(a){y=e(this).prop("id").substring(8)}),e(".modal_btn_label_delete").click(function(){e("#campaign_label_delete_modal").modal("toggle"),_()})});