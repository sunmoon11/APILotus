jQuery(document).ready(function(t){function e(e,n){"main"==e?(t(".site_management_alert").html(n),t(".site_management_alert").fadeIn(1e3,function(){t(".site_management_alert").fadeOut(3e3)})):"add"==e?(t(".url_add_alert").html(n),t(".url_add_alert").fadeIn(1e3,function(){t(".url_add_alert").fadeOut(3e3)})):"edit"==e?(t(".url_edit_alert").html(n),t(".url_edit_alert").fadeIn(1e3,function(){t(".url_edit_alert").fadeOut(3e3)})):"setting"==e&&(t(".url_setting_alert").html(n),t(".url_setting_alert").fadeIn(1e3,function(){t(".url_setting_alert").fadeOut(3e3)}))}function n(e){t(".site_management_waiting").html(e?f:"")}function i(n){var i=n.data,a=i.length;if(a>1){u="",p="";for(var o=0,l=1;l<a;l++){var d=i[l].join(",").split(",");""!==d[0]&&""!==d[1]&&(u+=d[0]+",",p+=d[1]+",",o++)}if(o>0){var r=o+" URLs have been parsed. Going to Add?";t(".confirm_message").html(r),t("#import_confirm_modal").modal("toggle")}else e("main","There are no urls parsed.")}else e("main","There are no urls parsed.")}function a(){n(!0),t.ajax({type:"GET",url:"../daemon/ajax_admin/monitor_lotus_urls_add.php",data:{site_name:u,site_url:p},success:function(t){if(n(!1),"success"==t)o();else{if("no_cookie"==t)return void(window.location.href="../../admin/login.php");"exist"==t?e("main","All URLs already exist."):e("main","URLs cannot be added.")}},failure:function(t){n(!1),e("main","URLs cannot be added.")}})}function o(){n(!0),t.ajax({type:"GET",url:"../daemon/ajax_admin/monitor_lotus_url_list.php",data:{page_number:g,items_page:b},success:function(i){if(n(!1),"error"!=i)if("no_cookie"!=i){var a=jQuery.parseJSON(i),o="";y=a.length;for(var l=a.urls.length,d=0;d<l;d++)o+="<tr>",o+="<td>"+((g-1)*b+d+1)+"</td>",o+='<td id="sname_'+a.urls[d][0]+'">'+a.urls[d][1]+"</td>",o+='<td id="surl_'+a.urls[d][0]+'">'+a.urls[d][2]+"</td>",o+="<td>",o+='<button type="button" class="btn btn-link btn-sm btn_url_edit icon_btn" id="'+a.urls[d][0]+'"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span>&nbsp;Edit</button>',o+='<button type="button" class="btn btn-link btn-sm btn_url_delete icon_btn" id="'+a.urls[d][0]+'"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span>&nbsp;Delete</button>',o+="</td></tr>";t(".table_url_body").html(o),c()}else window.location.href="../../admin/login.php";else e("main","Cannot load Monitor URL list.")},failure:function(t){n(!1),e("main","Cannot load Monitor URL list.")}})}function l(){n(!0),t.ajax({type:"GET",url:"../daemon/ajax_admin/monitor_lotus_url_add.php",data:{site_name:t(".add_site_name").val(),site_url:t(".add_site_url").val()},success:function(t){if(n(!1),"success"==t)o();else{if("no_cookie"==t)return void(window.location.href="../../admin/login.php");"exist"==t?e("main","This URL already exists."):e("main","URL cannot be added.")}},failure:function(t){n(!1),e("main","URL cannot be added.")}})}function d(){n(!0),t.ajax({type:"GET",url:"../daemon/ajax_admin/monitor_lotus_url_update.php",data:{site_id:m,site_name:t(".edit_site_name").val(),site_url:t(".edit_site_url").val()},success:function(t){if(n(!1),"success"==t)o();else{if("no_cookie"==t)return void(window.location.href="../../admin/login.php");"exist"==t?e("main","This URL already exists."):e("main","URL cannot be changed.")}},failure:function(t){n(!1),e("main","URL cannot be changed.")}})}function r(){n(!0),t.ajax({type:"GET",url:"../daemon/ajax_admin/monitor_lotus_url_delete.php",data:{site_id:m},success:function(t){if(n(!1),"success"==t)o();else{if("no_cookie"==t)return void(window.location.href="../../admin/login.php");e("main","URL cannot be deleted.")}},failure:function(t){n(!1),e("main","URL cannot be deleted.")}})}function s(){n(!0),t.ajax({type:"GET",url:"../daemon/ajax_admin/monitor_lotus_schedule_list.php",data:{},success:function(e){if(n(!1),"no_cookie"!=e){if("success"==e){var i=jQuery.parseJSON(e);t(".edit_interval").each(function(e){t(this).prop("checked",!1)}),t(".edit_receiver").each(function(e){t(this).prop("checked",!1)}),t("#min_"+i[0][1]).prop("checked",!0),1==i[0][2]&&t("#receiver_0").prop("checked",!0),1==i[0][3]&&t("#receiver_1").prop("checked",!0),1==i[0][4]&&t("#receiver_2").prop("checked",!0)}t("#url_setting_modal").modal("toggle")}else window.location.href="../../admin/login.php"},failure:function(t){n(!1),e("main","Cannot load Monitor URL Setting.")}})}function _(){var i=5,a=t("#receiver_0").prop("checked")?1:0,o=t("#receiver_1").prop("checked")?1:0,l=t("#receiver_2").prop("checked")?1:0;t(".edit_interval").each(function(e){t(this).prop("checked")&&(i=t(this).prop("id").substring(4))}),n(!0),t.ajax({type:"GET",url:"../daemon/ajax_admin/monitor_lotus_schedule_update.php",data:{interval:i,enable_sms:a,enable_email:o,enable_bot:l},success:function(t){n(!1),"error"!=t?"no_cookie"!=t||(window.location.href="../../admin/login.php"):e("main","Cannot update Monitor URL Setting.")},failure:function(t){n(!1),e("main","Cannot update Monitor URL Setting.")}})}function c(){var e="",n="";if(y>0){var i=Math.floor((g-1)/v),a=i*v+1,o=(i+1)*v;o*b>y&&(o=Math.floor(y/b),y%b>0&&o++);for(var l=a;l<=o;l++)e+=l==g?'<button type="button" class="btn btn-success btn-sm monitor_page" id="page_'+l+'">'+l+"</button>":'<button type="button" class="btn btn-default btn-sm monitor_page" id="page_'+l+'">'+l+"</button>";i>0&&(n+='<button type="button" class="btn btn-default btn-sm monitor_page" id="page_first">&lt;&lt;</button><button type="button" class="btn btn-default btn-sm monitor_page" id="page_prev">&lt;</button>'),n+=e,o*b<y&&(n+='<button type="button" class="btn btn-default btn-sm monitor_page" id="page_next">&gt;</button><button type="button" class="btn btn-default btn-sm monitor_page" id="page_last">&gt;&gt;</button>')}t(".monitor_pagination").html(n)}var u,p,m=-1,f='<img src="../images/loading.gif" style="width:22px;height:22px;">',h='<span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span>',g=1,b=10,v=7,y=0;o(),t("#url_add_modal").on("shown.bs.modal",function(){t(".add_site_name").focus()}),t("#url_edit_modal").on("shown.bs.modal",function(){t(".edit_site_name").focus()}),t(".btn_url_setting").click(function(){s()}),t(".modal_btn_url_setting").click(function(){_(),t("#url_setting_modal").modal("toggle")}),t(".btn_url_add").click(function(){t(".add_site_name").val(""),t(".add_site_url").val(""),t("#url_add_modal").modal("toggle")}),t(".modal_btn_url_add").click(function(){return""==t(".add_site_name").val()?(e("add","Please input Site Name."),void t(".add_site_name").focus()):""==t(".add_site_url").val()?(e("add","Please input Site URL."),void t(".add_site_url").focus()):(t("#url_add_modal").modal("toggle"),void l())}),t(".btn_url_import").click(function(){return t(".input_csv_picker").trigger("click"),!1}),t(".input_csv_picker").change(function(){t(".input_csv_picker").parse({config:{delimiter:"auto",complete:i},before:function(t,e){},error:function(t,n){e("main","Parseing failed.")},complete:function(){}})}),t(".modal_btn_import_yes").click(function(){t("#import_confirm_modal").modal("toggle"),a()}),t(".table_url_body").on("click",".btn_url_edit",function(e){m=t(this).prop("id"),t(".edit_site_name").val(t("#sname_"+m).text()),t(".edit_site_url").val(t("#surl_"+m).text()),t("#url_edit_modal").modal("toggle")}),t(".modal_btn_url_edit").click(function(){return""==t(".edit_site_name").val()?(e("edit","Please input Site Name."),void t(".edit_site_name").focus()):""==t(".edit_site_url").val()?(e("edit","Please input Site URL."),void t(".edit_site_url").focus()):(t("#url_edit_modal").modal("toggle"),void d())}),t(".table_url_body").on("click",".btn_url_delete",function(e){m=t(this).prop("id"),t("#url_delete_modal").modal("toggle")}),t(".modal_btn_url_delete").click(function(){t("#url_delete_modal").modal("toggle"),r()}),t(".btn_http_code").click(function(){var e=t(this).prop("id").substring(9);t(".btn_http_code").each(function(e){t(this).removeClass("active")}),t(this).addClass("active"),t("#code_type_100").hide(),t("#code_type_200").hide(),t("#code_type_300").hide(),t("#code_type_400").hide(),t("#code_type_500").hide(),t("#code_type_"+e).show()}),t(".btn_code_expand").click(function(){var e=t(this).prop("id").substring(11);t(this).html()==h?(t(this).html('<span class="glyphicon glyphicon-triangle-bottom" aria-hidden="true" style="color: #ffa5a5"></span>'),t("#code_expand_"+e).show()):(t(this).html(h),t("#code_expand_"+e).hide())}),t(".count_dropdown_menu li").on("click",function(e){b=t(this).text(),t(".count_toggle_button").html(b+' <span class="caret"></span>'),g=1,o()}),t(".monitor_pagination").on("click",".monitor_page",function(e){var n=t(this).prop("id").substring(5),i=Math.floor((g-1)/v);"first"==n?g=1:"prev"==n?g=(i-1)*v+1:"next"==n?g=(i+1)*v+1:"last"==n?(g=Math.floor(y/b),y%b>0&&g++):g=n,o()})});