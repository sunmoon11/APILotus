jQuery(document).ready(function(t){var e,a,o='<img src="../images/loading.gif" style="width:22px;height:22px;">',n=-1,s="",l="";function r(e,a){"home"==e?a?t(".ap_home_waiting").html(o):t(".ap_home_waiting").html(""):"customer"==e&&(a?t(".ap_customers_waiting").html(o):t(".ap_customers_waiting").html(""))}function c(e,a){"home"==e?(t(".ap_home_alert").html(a),t(".ap_home_alert").fadeIn(1e3,function(){t(".ap_home_alert").fadeOut(3e3)})):"customer"==e&&(t(".ap_customers_alert").html(a),t(".ap_customers_alert").fadeIn(1e3,function(){t(".ap_customers_alert").fadeOut(3e3)}))}function i(){r("customer",!0),t.ajax({type:"GET",url:"../daemon/ajax_adminpanel/customer_list.php",data:{},success:function(e){if(r("customer",!1),"error"!=e)if("no_cookie"!=e){var o="",n=jQuery.parseJSON(e);a=n[1];for(var s=0;s<a.length;s++){o+="<tr>",o+='<td id="domain_'+a[s][0]+'">'+a[s][8]+"</td>",o+="<td>"+a[s][1]+"</td>",o+="<td>"+a[s][7]+"</td>",o+="<td>"+a[s][2]+"</td>",o+="<td>"+a[s][9]+"</td>",o+="<td>"+a[s][10]+"</td>",o+="<td>"+a[s][15]+"</td>";var l="";l="1"==a[s][11]?'<span class="payment_badge payment_badge_blue">Verified</span>':'<span class="payment_badge payment_badge_red">Unverified</span>',"1"==a[s][12]&&(l='<span class="payment_badge payment_badge_red">Blocked</span>'),"1"==a[s][13]&&(l='<span class="payment_badge payment_badge_red">Deleted</span>'),o+="<td>"+l+"</td>",o+="<td>",o+='<button type="button" class="btn btn-link btn-sm btn_action btn_show_columns" id="'+a[s][0]+'" data-toggle="tooltip" data-placement="bottom" title="Show Columns for Dashboard"><span class="glyphicon glyphicon-check" aria-hidden="true"></span></button>',"1"==a[s][12]?o+='<button type="button" class="btn btn-link btn-sm btn_action btn_set_resume" id="'+a[s][0]+'" data-toggle="tooltip" data-placement="bottom" title="Resume Customer"><span class="glyphicon glyphicon-play" aria-hidden="true"></span></button>':o+='<button type="button" class="btn btn-link btn-sm btn_action btn_set_block" id="'+a[s][0]+'" data-toggle="tooltip" data-placement="bottom" title="Block Customer"><span class="glyphicon glyphicon-pause" aria-hidden="true" style="color: #ffa5a5"></span></button>',o+='<button type="button" class="btn btn-link btn-sm btn_action btn_enable_feature" id="'+a[s][0]+'" data-toggle="tooltip" data-placement="bottom" title="Enable Features"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span></button>',o+="</td></tr>"}t(".table_customers_body").html(o),t(".customers_result").html("around "+a.length+" results")}else window.location.href="../adminpanel/login.php";else c("customer","Cannot load customer details.")},failure:function(t){r("customer",!1),c("customer","Cannot load customer details.")}})}r("home",!0),t.ajax({type:"GET",url:"../daemon/ajax_adminpanel/subdomain_list.php",data:{},success:function(t){if(r("home",!1),"error"!=t)if("no_cookie"!=t){var a=jQuery.parseJSON(t);e=a[1],function(){var t=Chart.helpers.color,a={type:"pie",data:{datasets:[{data:[],backgroundColor:[t(window.chartColors.blue).alpha(.5).rgbString(),t(window.chartColors.red).alpha(.5).rgbString()]}],labels:["Active Sub-Domains","Blocked Sub-Domains"]},options:{title:{display:!1},legend:{display:!0,position:"right"},responsive:!0}};a.data.datasets[0].data.push(e.length),a.data.datasets[0].data.push("0");var o=document.getElementById("ap_subdomains_canvas").getContext("2d");o.canvas.height=100,window.myPie=new Chart(o,a)}(),function(){for(var t=Chart.helpers.color,a={type:"pie",data:{datasets:[{data:[],backgroundColor:[t(window.chartColors.blue).alpha(.5).rgbString(),t(window.chartColors.red).alpha(.5).rgbString()]}],labels:["Active Accounts","Blocked Accounts"]},options:{title:{display:!1},legend:{display:!0,position:"right"},responsive:!0,showTooltips:!0}},o=0,n=0,s=0;s<e.length;s++)o+=e[s][2]-e[s][3],n+=e[s][3];a.data.datasets[0].data.push(o),a.data.datasets[0].data.push(n);var l=document.getElementById("ap_accounts_canvas").getContext("2d");l.canvas.height=100,window.myPie=new Chart(l,a)}(),function(){for(var t=Chart.helpers.color,a={type:"pie",data:{datasets:[{data:[],backgroundColor:[t(window.chartColors.blue).alpha(.5).rgbString(),t(window.chartColors.red).alpha(.5).rgbString()]}],labels:["Active CRMs","Blocked CRMs"]},options:{title:{display:!1},legend:{display:!0,position:"right"},responsive:!0}},o=0,n=0,s=0;s<e.length;s++)o+=e[s][4]-e[s][5],n+=e[s][5];a.data.datasets[0].data.push(o),a.data.datasets[0].data.push(n);var l=document.getElementById("ap_crms_canvas").getContext("2d");l.canvas.height=100,window.myPie=new Chart(l,a)}()}else window.location.href="../adminpanel/login.php";else c("home","Cannot load accounts list.")},failure:function(t){r("home",!1),c("home","Cannot load accounts list.")}}),i(),t(".table_customers_body").on("click",".btn_show_columns",function(e){n=t(this).prop("id"),s=t("#domain_"+n).html(),r("customer",!0),t.ajax({type:"GET",url:"../daemon/ajax_adminpanel/dashboard_columns_list.php",data:{sub_domain:s},success:function(e){if(r("customer",!1),"no_cookie"!=e){var a=jQuery.parseJSON(e);if("success"==a[0]){""==(l=a[1])&&(l="1,2,3,4,5,6,7,8");for(var o=l.split(","),n=1;n<=8;n++){t(".show_column_"+n).prop("checked",!1);for(var s=0;s<o.length;s++)if(n==o[s]){t(".show_column_"+n).prop("checked",!0);break}}t("#show_columns_modal").modal("toggle")}}else window.location.href="../adminpanel/login.php"},failure:function(t){r("customer",!1),c("customer","Cannot load columns for dashboard.")}})}),t(".modal_btn_show_columns").click(function(){for(var e,a="",o=1;o<=8;o++)t(".show_column_"+o).prop("checked")&&(""!=a&&(a+=","),a+=o);t("#show_columns_modal").modal("toggle"),e=a,r("customer",!0),t.ajax({type:"GET",url:"../daemon/ajax_adminpanel/dashboard_columns_update.php",data:{sub_domain:s,show_columns:e},success:function(t){if(r("customer",!1),"error"==t)c("customer","Cannot update columns for dashboard.");else{if("no_cookie"==t)return void(window.location.href="../adminpanel/login.php");l=e}},failure:function(t){r("customer",!1),c("customer","Cannot update columns for dashboard.")}})}),t(".table_customers_body").on("click",".btn_set_resume",function(e){n=t(this).prop("id"),t("#customer_resume_modal").modal("toggle")}),t(".modal_btn_customer_resume").click(function(){t("#customer_resume_modal").modal("toggle"),r("customer",!0),t.ajax({type:"GET",url:"../daemon/ajax_adminpanel/customer_status_update.php",data:{customer_id:n,block:"0"},success:function(t){r("customer",!1),"success"!=t?"no_cookie"!=t?"error"==t&&c("customer","This customer cannot be resume."):window.location.href="../adminpanel/login.php":i()},failure:function(t){r("customer",!1),c("customer","This customer cannot be resume.")}})}),t(".table_customers_body").on("click",".btn_set_block",function(e){n=t(this).prop("id"),t("#customer_block_modal").modal("toggle")}),t(".modal_btn_customer_block").click(function(){t("#customer_block_modal").modal("toggle"),r("customer",!0),t.ajax({type:"GET",url:"../daemon/ajax_adminpanel/customer_status_update.php",data:{customer_id:n,block:"1"},success:function(t){r("customer",!1),"success"!=t?"no_cookie"!=t?"error"==t&&c("customer","This customer cannot be blocked."):window.location.href="../adminpanel/login.php":i()},failure:function(t){r("customer",!1),c("customer","This customer cannot be blocked.")}})}),t(".table_customers_body").on("click",".btn_enable_feature",function(e){n=t(this).prop("id"),s=t("#domain_"+n).html(),r("customer",!0),t.ajax({type:"GET",url:"../daemon/ajax_adminpanel/feature_enable_list.php",data:{sub_domain:s},success:function(e){if(r("customer",!1),"no_cookie"!=e){var a=jQuery.parseJSON(e);if("success"==a[0]){var o=a[1];o=o.split(",");for(var n=1;n<=4;n++){t(".enable_feature_"+n).prop("checked",!1);for(var s=0;s<o.length;s++)if(n==o[s]){t(".enable_feature_"+n).prop("checked",!0);break}}t("#enable_feature_modal").modal("toggle")}}else window.location.href="../adminpanel/login.php"},failure:function(t){r("customer",!1),c("customer","Cannot load feature enabled.")}})}),t(".modal_btn_enable_feature").click(function(){for(var e,a="",o=1;o<=4;o++)t(".enable_feature_"+o).prop("checked")&&(""!=a&&(a+=","),a+=o);t("#enable_feature_modal").modal("toggle"),e=a,r("customer",!0),t.ajax({type:"GET",url:"../daemon/ajax_adminpanel/feature_enable_update.php",data:{sub_domain:s,enable_feature:e},success:function(t){if(r("customer",!1),"error"==t)c("customer","Cannot update feature enabled.");else if("no_cookie"==t)return void(window.location.href="../adminpanel/login.php")},failure:function(t){r("customer",!1),c("customer","Cannot update feature enabled.")}})})});