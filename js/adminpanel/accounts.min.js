jQuery(document).ready(function(a){var t,n,e='<img src="../images/loading.gif" style="width:22px;height:22px;">',o=-1;function d(t,n){"account"==t?n?a(".ap_accounts_waiting").html(e):a(".ap_accounts_waiting").html(""):"detail"==t&&(n?a(".ap_account_detail_waiting").html(e):a(".ap_account_detail_waiting").html(""))}function i(t,n){"account"==t?(a(".ap_accounts_alert").html(n),a(".ap_accounts_alert").fadeIn(1e3,function(){a(".ap_accounts_alert").fadeOut(3e3)})):"detail"==t?(a(".ap_account_detail_alert").html(n),a(".ap_account_detail_alert").fadeIn(1e3,function(){a(".ap_account_detail_alert").fadeOut(3e3)})):"password"==t&&(a(".change_password_alert").html(n),a(".change_password_alert").fadeIn(1e3,function(){a(".change_password_alert").fadeOut(3e3)}))}function l(){var t=a(".select_sub_domain option:selected").text();""!=t&&(d("detail",!0),a.ajax({type:"GET",url:"../daemon/ajax_adminpanel/account_list.php",data:{sub_domain:t},success:function(t){if(d("detail",!1),"error"!=t)if("no_cookie"!=t){var e="",o=jQuery.parseJSON(t);n=o[1];for(var l=0;l<n.length;l++)e+="<tr>",e+='<td id="name_'+n[l][0]+'">'+n[l][1]+"</td>",e+='<td id="disp_'+n[l][0]+'">'+n[l][3]+"</td>","1"==n[l][10]||""==n[l][7]?e+='<td id="sms_'+n[l][0]+'">'+n[l][7]+"</td>":e+='<td id="sms_'+n[l][0]+'"><span class="payment_badge payment_badge_red">'+n[l][7]+"</span></td>","1"==n[l][11]||""==n[l][8]?e+='<td id="email_'+n[l][0]+'">'+n[l][8]+"</td>":e+='<td id="email_'+n[l][0]+'"><span class="payment_badge payment_badge_red" style="text-transform: none">'+n[l][8]+"</span></td>","1"==n[l][12]||""==n[l][9]?e+='<td id="bot_'+n[l][0]+'">'+n[l][9]+"</td>":e+='<td id="bot_'+n[l][0]+'"><span class="payment_badge payment_badge_red">'+n[l][9]+"</span></td>","9"==n[l][4]?e+='<td id="role_'+n[l][0]+'">Administrator</td>':"1"==n[l][4]?e+='<td id="role_'+n[l][0]+'">Super User</td>':"0"==n[l][4]?e+='<td id="role_'+n[l][0]+'">Regular User</td>':e+='<td id="role_'+n[l][0]+'">Unknown</td>',"1"==n[l][5]?e+='<td id="state_'+n[l][0]+'"><span class="payment_badge payment_badge_blue">Enable</span></td><td>':e+='<td id="state_'+n[l][0]+'"><span class="payment_badge payment_badge_red">Disable</span></td><td>',e+='<button type="button" class="btn btn-link btn-sm btn_action btn_change_password" id="'+n[l][0]+'" data-toggle="tooltip" data-placement="bottom" title="Change Password"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span></button>',"1"==n[l][5]?e+='<button type="button" class="btn btn-link btn-sm btn_action btn_account_disable" id="'+n[l][0]+'" data-toggle="tooltip" data-placement="bottom" title="Disable Account"><span class="glyphicon glyphicon-pause" aria-hidden="true" style="color: #ffa5a5"></span></button>':e+='<button type="button" class="btn btn-link btn-sm btn_action btn_account_enable" id="'+n[l][0]+'" data-toggle="tooltip" data-placement="bottom" title="Enable Account"><span class="glyphicon glyphicon-play" aria-hidden="true"></span></button>',e+="</td></tr>";a(".table_account_body").html(e),a(".account_detail_result").html("around "+n.length+" results")}else window.location.href="../adminpanel/login.php";else i("detail","Cannot load account details.")},failure:function(a){d("detail",!1),i("detail","Cannot load account details.")}}))}d("account",!0),a.ajax({type:"GET",url:"../daemon/ajax_adminpanel/subdomain_list.php",data:{},success:function(n){if(d("account",!1),"error"!=n)if("no_cookie"!=n){var e=jQuery.parseJSON(n);t=e[1],function(){for(var a=Chart.helpers.color,n={labels:[],datasets:[{label:"Blocked Accounts",backgroundColor:a(window.chartColors.red).alpha(.5).rgbString(),data:[]},{label:"Active Account",backgroundColor:a(window.chartColors.blue).alpha(.5).rgbString(),data:[]}]},e=0;e<t.length;e++)n.labels.push(t[e][1]),n.datasets[0].data.push(t[e][3]),n.datasets[1].data.push(t[e][2]-t[e][3]);var o=document.getElementById("ap_accounts_canvas").getContext("2d");o.canvas.height=15*t.length,window.myAccountBar=new Chart(o,{type:"horizontalBar",data:n,options:{title:{display:!1},legend:{display:!0,position:"right"},responsive:!0,scales:{xAxes:[{stacked:!0,gridLines:{display:!1}}],yAxes:[{stacked:!0,gridLines:{display:!1}}]},tooltips:{mode:"index"}}})}(),function(){for(var n="",e=0;e<t.length;e++)n+='<option value="'+t[e][0]+'" style="padding:5px;">'+t[e][1]+"</option>";a(".select_sub_domain").html(n),l()}()}else window.location.href="../adminpanel/login.php";else i("account","Cannot load accounts list.")},failure:function(a){d("account",!1),i("account","Cannot load accounts list.")}}),a(".select_sub_domain").change(function(){l()}),a(".table_account_body").on("click",".btn_change_password",function(t){o=a(this).prop("id"),a(".input_password").val(""),a(".input_repassword").val(""),a("#change_password_modal").modal("toggle")}),a(".modal_btn_change_password").click(function(){return""==a(".input_password").val()?(i("password","Please input New Password."),void a(".input_password").focus()):a(".input_password").val()!=a(".input_repassword").val()?(i("password","Doesn't match password."),void a(".input_repassword").focus()):(a("#change_password_modal").modal("toggle"),d("detail",!0),void a.ajax({type:"GET",url:"../daemon/ajax_adminpanel/account_password_update.php",data:{sub_domain:a(".select_sub_domain option:selected").text(),account_id:o,password:a(".input_password").val()},success:function(a){d("detail",!1),"no_cookie"!=a?"error"==a&&i("detail","Password cannot be changed."):window.location.href="../adminpanel/login.php"},failure:function(a){d("detail",!1),i("detail","Password cannot be changed.")}}))}),a(".table_account_body").on("click",".btn_account_enable",function(t){o=a(this).prop("id"),a("#account_enable_modal").modal("toggle")}),a(".modal_btn_account_enable").click(function(){a("#account_enable_modal").modal("toggle"),d("detail",!0),a.ajax({type:"GET",url:"../daemon/ajax_adminpanel/account_status_update.php",data:{sub_domain:a(".select_sub_domain option:selected").text(),account_id:o,status:"1"},success:function(a){d("detail",!1),"success"!=a?"no_cookie"!=a?"error"==a&&i("detail","This account cannot be enabled."):window.location.href="../adminpanel/login.php":l()},failure:function(a){d("detail",!1),i("detail","This account cannot be enabled.")}})}),a(".table_account_body").on("click",".btn_account_disable",function(t){o=a(this).prop("id"),a("#account_disable_modal").modal("toggle")}),a(".modal_btn_account_disable").click(function(){a("#account_disable_modal").modal("toggle"),d("detail",!0),a.ajax({type:"GET",url:"../daemon/ajax_adminpanel/account_status_update.php",data:{sub_domain:a(".select_sub_domain option:selected").text(),account_id:o,status:"0"},success:function(a){d("detail",!1),"success"!=a?"no_cookie"!=a?"error"==a&&i("detail","This account cannot be disabled."):window.location.href="../adminpanel/login.php":l()},failure:function(a){d("detail",!1),i("detail","This account cannot be disabled.")}})})});