jQuery(document).ready(function(t){function a(a,e){"chart"==a?e?t(".ap_chart_waiting").html(u):t(".ap_chart_waiting").html(""):"detail"==a&&(e?t(".ap_detail_waiting").html(u):t(".ap_detail_waiting").html(""))}function e(a,e){"chart"==a?(t(".ap_chart_alert").html(e),t(".ap_chart_alert").fadeIn(1e3,function(){t(".ap_chart_alert").fadeOut(3e3)})):"detail"==a&&(t(".ap_detail_alert").html(e),t(".ap_detail_alert").fadeIn(1e3,function(){t(".ap_detail_alert").fadeOut(3e3)}))}function n(){a("chart",!0),t.ajax({type:"GET",url:"../daemon/ajax_adminpanel/payment_list.php",data:{},success:function(t){if(a("chart",!1),"error"!=t)if("no_cookie"!=t){var n=jQuery.parseJSON(t);p=n[1],d(),i(),o()}else window.location.href="../adminpanel/login.php";else e("chart","Cannot load payment list.")},failure:function(t){a("chart",!1),e("chart","Cannot load payment list.")}})}function d(){for(var t=Chart.helpers.color,a={type:"pie",data:{datasets:[{data:[],backgroundColor:[t(window.chartColors.blue).alpha(.5).rgbString(),t(window.chartColors.red).alpha(.5).rgbString()]}],labels:["Active Cards","Blocked Cards"]},options:{title:{display:!1},legend:{display:!0,position:"right"},responsive:!0}},e=0,n=0;n<p.length;n++)""!=p[n][6]&&e++;a.data.datasets[0].data.push(e),a.data.datasets[0].data.push(0);var d=document.getElementById("ap_cards_canvas").getContext("2d");d.canvas.height=80,window.myPie=new Chart(d,a)}function i(){for(var t=Chart.helpers.color,a={type:"pie",data:{datasets:[{data:[],backgroundColor:[t(window.chartColors.blue).alpha(.5).rgbString(),t(window.chartColors.red).alpha(.5).rgbString()]}],labels:["Active Subscriptions","Blocked Subscriptions"]},options:{title:{display:!1},legend:{display:!0,position:"right"},responsive:!0}},e=0,n=0;n<p.length;n++)""!=p[n][5]&&e++;a.data.datasets[0].data.push(e),a.data.datasets[0].data.push(0);var d=document.getElementById("ap_subscriptions_canvas").getContext("2d");d.canvas.height=80,window.myPie=new Chart(d,a)}function o(){for(var a="",e=0;e<p.length;e++)a+="<tr>",a+='<td id="domain_'+p[e][0]+'">'+p[e][2]+"</td>",a+="<td>"+p[e][1]+"</td>",a+="<td>"+p[e][3]+"</td>",a+="<td>"+p[e][6]+"</td>",a+="<td>"+p[e][5]+"</td>",a+="<td>"+p[e][9]+"</td>",a+="<td>"+p[e][10]+"</td>",a+='<td><button type="button" class="btn btn-link btn-sm btn_action btn_view_card" id="'+p[e][0]+'" data-toggle="tooltip" data-placement="bottom" title="View Card Information"><span class="glyphicon glyphicon-credit-card" aria-hidden="true"></span></button>',a+='<button type="button" class="btn btn-link btn-sm btn_action btn_view_subscription" id="'+p[e][0]+'" data-toggle="tooltip" data-placement="bottom" title="View Subscription Information"><span class="glyphicon glyphicon-record" aria-hidden="true"></span></button>',a+='<button type="button" class="btn btn-link btn-sm btn_action btn_view_invoice" id="'+p[e][0]+'" data-toggle="tooltip" data-placement="bottom" title="View Payment History"><span class="glyphicon glyphicon-usd" aria-hidden="true" style="color: #ffa5a5"></span></button>',a+="</td></tr>";t(".table_detail_body").html(a),t(".detail_result").html("around "+p.length+" results")}function r(){a("detail",!0),t.ajax({type:"GET",url:"../daemon/ajax_adminpanel/payment_card_list.php",data:{sub_domain:_},success:function(n){if(a("detail",!1),"no_cookie"!=n)if("error"==n)e("detail","This card information cannot be viewed.");else{var d=jQuery.parseJSON(n),i="";"success"==d[0]&&(i="<tr><th>Card Brand</th><th>"+d[1].brand+"</th></tr>",t("#table_card_head").html(i),i="<tr><td>Country</td><td>"+d[1].country+"</td></tr>",i+="<tr><td>Card Number</td><td>**** **** **** "+d[1].last4+"</td></tr>",i+="<tr><td>Expiry Date</td><td>"+d[1].exp_month+" / "+d[1].exp_year+"</td></tr>","pass"==d[1].cvc_check?i+='<tr><td>CVC Check</td><td><span class="payment_badge payment_badge_blue">passed</span></td></tr>':i+='<tr><td>CVC Check</td><td><span class="payment_badge payment_badge_red">'+d[1].cvc_check+"</span></td></tr>",i+="<tr><td>Card ID</td><td>"+d[1].id+"</td></tr>",t("#table_card_body").html(i),t("#view_card_modal").modal("toggle"))}else window.location.href="../adminpanel/login.php"},failure:function(t){a("detail",!1),e("detail","This card information cannot be viewed.")}})}function l(){a("detail",!0),t.ajax({type:"GET",url:"../daemon/ajax_adminpanel/payment_subscription_list.php",data:{sub_domain:_},success:function(n){if(a("detail",!1),"no_cookie"!=n)if("error"==n)e("detail","This subscription information cannot be viewed.");else{var d=jQuery.parseJSON(n),i="";"success"==d[0]&&(i="<tr><th>Plan Name</th><th>"+d[1].plan.id+"</th></tr>",t("#table_subscription_head").html(i),i="<tr><td>Price</td><td>$"+d[1].plan.amount/100+"</td></tr>",i+="<tr><td>Interval</td><td>"+d[1].plan.interval+"</td></tr>",i+="<tr><td>Subscription Created Date</td><td>"+c(d[1].created)+"</td></tr>",i+="<tr><td>Current Period Start</td><td>"+c(d[1].current_period_start)+"</td></tr>",i+="<tr><td>Current Period End</td><td>"+c(d[1].current_period_end)+"</td></tr>","active"==d[1].status?i+='<tr><td>Subscription Status</td><td><span class="payment_badge payment_badge_blue">'+d[1].status+"</span></td></tr>":i+='<tr><td>Subscription Status</td><td><span class="payment_badge payment_badge_red">'+d[1].status+"</span></td></tr>",i+="<tr><td>Subscription ID</td><td>"+d[1].id+"</td></tr>",t("#table_subscription_body").html(i),t("#view_subscription_modal").modal("toggle"))}else window.location.href="../adminpanel/login.php"},failure:function(t){a("detail",!1),e("detail","This subscription information cannot be viewed.")}})}function s(){a("detail",!0),t.ajax({type:"GET",url:"../daemon/ajax_adminpanel/payment_invoices_list.php",data:{sub_domain:_},success:function(n){if(a("detail",!1),"no_cookie"!=n)if("error"==n)e("detail","This payment history cannot be viewed.");else{var d=jQuery.parseJSON(n),i="";if("success"==d[0]){for(var o=d[1].data.length,r=0;r<o;r++)i+="<tr>",i+="<td>"+(r+1)+"</td>",i+="<td>$"+d[1].data[r].amount_due/100+"</td>",1==d[1].data[r].paid?i+='<td><span class="payment_badge payment_badge_cyan">Paid</span></td>':i+="<td></td>",i+="<td>"+c(d[1].data[r].date)+"</td>",i+="<td>"+c(d[1].data[r].period_start)+" - "+c(d[1].data[r].period_end)+"</td>",i+="<td>"+d[1].data[r].id+"</td>",i+="</tr>";t("#table_invoice_body").html(i),t("#view_invoice_modal").modal("toggle")}}else window.location.href="../adminpanel/login.php"},failure:function(t){a("detail",!1),e("detail","This payment history cannot be viewed.")}})}function c(t){var a=new Date(1e3*t);return a.getFullYear()+"/"+((a.getMonth()<9?"0":"")+(a.getMonth()+1))+"/"+((a.getDate()<10?"0":"")+a.getDate())+" "+((a.getHours()<10?"0":"")+a.getHours())+":"+((a.getMinutes()<10?"0":"")+a.getMinutes())+":"+((a.getSeconds()<10?"0":"")+a.getSeconds())}var p,u='<img src="../images/loading.gif" style="width:22px;height:22px;">',_="";n(),t(".table_detail_body").on("click",".btn_view_card",function(a){var e=t(this).prop("id");_=t("#domain_"+e).html(),r()}),t(".table_detail_body").on("click",".btn_view_subscription",function(a){var e=t(this).prop("id");_=t("#domain_"+e).html(),l()}),t(".table_detail_body").on("click",".btn_view_invoice",function(a){var e=t(this).prop("id");_=t("#domain_"+e).html(),s()})});