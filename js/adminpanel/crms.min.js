jQuery(document).ready(function(a){function t(t,e){"crm"==t?e?a(".ap_crms_waiting").html(u):a(".ap_crms_waiting").html(""):"detail"==t&&(e?a(".ap_crm_detail_waiting").html(u):a(".ap_crm_detail_waiting").html(""))}function e(t,e){"crm"==t?(a(".ap_crms_alert").html(e),a(".ap_crms_alert").fadeIn(1e3,function(){a(".ap_crms_alert").fadeOut(3e3)})):"detail"==t?(a(".ap_crm_detail_alert").html(e),a(".ap_crm_detail_alert").fadeIn(1e3,function(){a(".ap_crm_detail_alert").fadeOut(3e3)})):"crm_password"==t?(a(".crm_password_alert").html(e),a(".crm_password_alert").fadeIn(1e3,function(){a(".crm_password_alert").fadeOut(3e3)})):"api_password"==t&&(a(".api_password_alert").html(e),a(".api_password_alert").fadeIn(1e3,function(){a(".api_password_alert").fadeOut(3e3)}))}function n(){t("crm",!0),a.ajax({type:"GET",url:"../daemon/ajax_adminpanel/subdomain_list.php",data:{},success:function(a){if(t("crm",!1),"error"!=a)if("no_cookie"!=a){var n=jQuery.parseJSON(a);p=n[1],o(),d()}else window.location.href="../adminpanel/login.php";else e("crm","Cannot load crms list.")},failure:function(a){t("crm",!1),e("crm","Cannot load crms list.")}})}function o(){for(var a=Chart.helpers.color,t={labels:[],datasets:[{label:"Paused CRMs",backgroundColor:a(window.chartColors.red).alpha(.5).rgbString(),data:[]},{label:"Active CRMs",backgroundColor:a(window.chartColors.blue).alpha(.5).rgbString(),data:[]}]},e=0;e<p.length;e++)t.labels.push(p[e][1]),t.datasets[0].data.push(p[e][5]),t.datasets[1].data.push(p[e][4]-p[e][5]);var n=document.getElementById("ap_crms_canvas").getContext("2d");n.canvas.height=15*p.length,window.myAccountBar=new Chart(n,{type:"horizontalBar",data:t,options:{title:{display:!1},legend:{display:!0,position:"right"},responsive:!0,scales:{xAxes:[{stacked:!0,gridLines:{display:!1}}],yAxes:[{stacked:!0,gridLines:{display:!1}}]},tooltips:{mode:"index"}}})}function d(){for(var t="",e=0;e<p.length;e++)t+='<option value="'+p[e][0]+'" style="padding:5px;">'+p[e][1]+"</option>";a(".select_sub_domain").html(t),s()}function s(){var n=a(".select_sub_domain option:selected").text();""!=n&&(t("detail",!0),a.ajax({type:"GET",url:"../daemon/ajax_adminpanel/crm_list.php",data:{sub_domain:n},success:function(n){if(t("detail",!1),"error"!=n)if("no_cookie"!=n){var o="",d=jQuery.parseJSON(n);_=d[1];for(var s=0;s<_.length;s++){if(o+="<tr>",o+='<td id="name_'+_[s][0]+'">'+_[s][1]+"</td>",o+='<td id="url_'+_[s][0]+'">'+_[s][2]+"</td>",o+='<td id="id1_'+_[s][0]+'">'+_[s][3]+"</td>",o+='<td id="pass1_'+_[s][0]+'">'+_[s][4]+"</td>",o+='<td id="id2_'+_[s][0]+'">'+_[s][5]+"</td>",o+='<td id="pass2_'+_[s][0]+'">'+_[s][6]+"</td>",o+='<td id="goal_'+_[s][0]+'">'+_[s][7]+"</td>","1"==_[s][8]?o+='<td id="paused_'+_[s][0]+'"><span class="payment_badge payment_badge_red">Paused</span></td>':o+='<td id="paused_'+_[s][0]+'"></td>',"0000-00-00"==_[s][9]||null==_[s][9])o+='<td id="valid_'+_[s][0]+'"><span class="payment_badge payment_badge_red">No set password date</span></td>';else{var i=_[s][9].split("-"),l=_[s][10].split("-"),r=Date.UTC(i[0],i[1]-1,i[2]),c=Date.UTC(l[0],l[1]-1,l[2]),p=30-Math.abs((r.valueOf()-c.valueOf())/864e5);p<0&&(p=0),o+=p<5?'<td id="valid_'+_[s][0]+'"><span class="payment_badge payment_badge_red">'+p+"</span></td>":'<td id="valid_'+_[s][0]+'">'+p+"</td>"}o+="<td>",o+='<button type="button" class="btn btn-link btn-sm btn_action btn_crm_password" id="'+_[s][0]+'" data-toggle="tooltip" data-placement="bottom" title="Change CRM Password"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span></button>',o+='<button type="button" class="btn btn-link btn-sm btn_action btn_api_password" id="'+_[s][0]+'" data-toggle="tooltip" data-placement="bottom" title="Change API Password"><span class="glyphicon glyphicon-lock" aria-hidden="true" style="color: #6569f4"></span></button>',"1"==_[s][8]?o+='<button type="button" class="btn btn-link btn-sm btn_action btn_resume_crm" id="'+_[s][0]+'" data-toggle="tooltip" data-placement="bottom" title="Resume CRM"><span class="glyphicon glyphicon-play" aria-hidden="true"></span></button>':o+='<button type="button" class="btn btn-link btn-sm btn_action btn_pause_crm" id="'+_[s][0]+'" data-toggle="tooltip" data-placement="bottom" title="Pause CRM"><span class="glyphicon glyphicon-pause" aria-hidden="true" style="color: #ffa5a5"></span></button>',o+="</td></tr>"}a(".table_crm_body").html(o),a(".crm_detail_result").html("around "+_.length+" results")}else window.location.href="../adminpanel/login.php";else e("detail","Cannot load crm details.")},failure:function(a){t("detail",!1),e("detail","Cannot load crm details.")}}))}function i(){t("detail",!0),a.ajax({type:"GET",url:"../daemon/ajax_adminpanel/crm_password_update.php",data:{sub_domain:a(".select_sub_domain option:selected").text(),crm_id:m,crm_password:a(".input_crm_password").val()},success:function(a){if(t("detail",!1),"success"==a)s();else{if("no_cookie"==a)return void(window.location.href="../adminpanel/login.php");e("detail","CRM Password cannot be changed.")}},failure:function(a){t("detail",!1),e("detail","CRM Password cannot be changed.")}})}function l(){t("detail",!0),a.ajax({type:"GET",url:"../daemon/ajax_adminpanel/api_password_update.php",data:{sub_domain:a(".select_sub_domain option:selected").text(),crm_id:m,api_password:a(".input_api_password").val()},success:function(a){if(t("detail",!1),"success"==a)s();else{if("no_cookie"==a)return void(window.location.href="../adminpanel/login.php");e("detail","API Password cannot be changed.")}},failure:function(a){t("detail",!1),e("detail","API Password cannot be changed.")}})}function r(){t("detail",!0),a.ajax({type:"GET",url:"../daemon/ajax_adminpanel/crm_status_update.php",data:{sub_domain:a(".select_sub_domain option:selected").text(),crm_id:m,paused:"0"},success:function(a){t("detail",!1),"success"!=a?"no_cookie"!=a?"error"==a&&e("detail","This crm cannot be enabled."):window.location.href="../adminpanel/login.php":s()},failure:function(a){t("detail",!1),e("detail","This crm cannot be enabled.")}})}function c(){t("detail",!0),a.ajax({type:"GET",url:"../daemon/ajax_adminpanel/crm_status_update.php",data:{sub_domain:a(".select_sub_domain option:selected").text(),crm_id:m,paused:"1"},success:function(a){t("detail",!1),"success"!=a?"no_cookie"!=a?"error"==a&&e("detail","This crm cannot be paused."):window.location.href="../adminpanel/login.php":s()},failure:function(a){t("detail",!1),e("detail","This crm cannot be paused.")}})}var p,_,u='<img src="../images/loading.gif" style="width:22px;height:22px;">',m=-1;n(),a(".table_crm_body").on("click",".btn_crm_password",function(t){m=a(this).prop("id"),a(".input_crm_password").val(""),a(".input_crm_repassword").val(""),a("#crm_password_modal").modal("toggle")}),a(".modal_btn_crm_password").click(function(){return""==a(".input_crm_password").val()?(e("crm_password","Please input New Password."),void a(".input_crm_password").focus()):a(".input_crm_password").val()!=a(".input_crm_repassword").val()?(e("crm_password","Doesn't match password."),void a(".input_crm_repassword").focus()):(a("#crm_password_modal").modal("toggle"),void i())}),a(".table_crm_body").on("click",".btn_api_password",function(t){m=a(this).prop("id"),a(".input_api_password").val(""),a(".input_api_repassword").val(""),a("#api_password_modal").modal("toggle")}),a(".modal_btn_api_password").click(function(){return""==a(".input_api_password").val()?(e("api_password","Please input New Password."),void a(".input_api_password").focus()):a(".input_api_password").val()!=a(".input_api_repassword").val()?(e("api_password","Doesn't match password."),void a(".input_api_repassword").focus()):(a("#api_password_modal").modal("toggle"),void l())}),a(".table_crm_body").on("click",".btn_resume_crm",function(t){m=a(this).prop("id"),a("#account_enable_modal").modal("toggle")}),a(".modal_btn_account_enable").click(function(){a("#account_enable_modal").modal("toggle"),r()}),a(".table_crm_body").on("click",".btn_pause_crm",function(t){m=a(this).prop("id"),a("#account_pause_modal").modal("toggle")}),a(".modal_btn_account_pause").click(function(){a("#account_pause_modal").modal("toggle"),c()}),a(".select_sub_domain").change(function(){s()})});